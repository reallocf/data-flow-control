"""Tests for optimized TPC-H policy count rewriting."""

import contextlib
import re

import pytest
from sql_rewriter import SQLRewriter
import sqlglot

from vldb_experiments.baselines.logical_baseline import rewrite_query_logical_multi
from vldb_experiments.baselines.physical_baseline import (
    execute_precomputed_query_physical_detailed,
    execute_query_physical_detailed,
)
from vldb_experiments.baselines.physical_rewriter import rewrite_query_physical
from vldb_experiments.correctness import compare_results_exact
from vldb_experiments.strategies.tpch_policy_count_optimized_queries import (
    get_cached_tpch_q01_optimized_queries,
)
from vldb_experiments.strategies.tpch_policy_count_optimized_strategy import (
    build_tpch_q01_optimized_policies,
    build_tpch_q01_optimized_strongest_policy,
)
from vldb_experiments.strategies.tpch_strategy import _ensure_smokedduck, load_tpch_query

POLICY_COUNTS = [1, 10, 100, 1000]


@pytest.fixture(scope="module")
def tpch_conn():
    """Create a DuckDB connection with TPC-H data loaded (sf=0.1)."""
    conn = _ensure_smokedduck().connect(":memory:")
    with contextlib.suppress(Exception):
        conn.execute("INSTALL tpch")
    conn.execute("LOAD tpch")
    conn.execute("CALL dbgen(sf=0.1)")
    yield conn
    conn.close()


EXPECTED_SQL_Q01 = {
    1: r"""WITH base_query AS (SELECT l_returnflag, l_linestatus, SUM(l_quantity) AS sum_qty, SUM(l_extendedprice) AS sum_base_price, SUM(l_extendedprice * (1 - l_discount)) AS sum_disc_price, SUM(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge, AVG(l_quantity) AS avg_qty, AVG(l_extendedprice) AS avg_price, AVG(l_discount) AS avg_disc, COUNT(*) AS count_order FROM lineitem WHERE l_shipdate <= CAST('1998-09-02' AS DATE) GROUP BY l_returnflag, l_linestatus) SELECT base_query.l_returnflag, base_query.l_linestatus, MAX(base_query.sum_qty) AS sum_qty, MAX(base_query.sum_base_price) AS sum_base_price, MAX(base_query.sum_disc_price) AS sum_disc_price, MAX(base_query.sum_charge) AS sum_charge, MAX(base_query.avg_qty) AS avg_qty, MAX(base_query.avg_price) AS avg_price, MAX(base_query.avg_disc) AS avg_disc, MAX(base_query.count_order) AS count_order FROM base_query, lineitem WHERE lineitem.l_shipdate <= CAST('1998-09-02' AS DATE) AND base_query.l_returnflag = lineitem.l_returnflag AND base_query.l_linestatus = lineitem.l_linestatus GROUP BY base_query.l_returnflag, base_query.l_linestatus HAVING (MAX(lineitem.l_quantity) > 0) ORDER BY base_query.l_returnflag, base_query.l_linestatus""",
    10: r"""WITH base_query AS (SELECT l_returnflag, l_linestatus, SUM(l_quantity) AS sum_qty, SUM(l_extendedprice) AS sum_base_price, SUM(l_extendedprice * (1 - l_discount)) AS sum_disc_price, SUM(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge, AVG(l_quantity) AS avg_qty, AVG(l_extendedprice) AS avg_price, AVG(l_discount) AS avg_disc, COUNT(*) AS count_order FROM lineitem WHERE l_shipdate <= CAST('1998-09-02' AS DATE) GROUP BY l_returnflag, l_linestatus) SELECT base_query.l_returnflag, base_query.l_linestatus, MAX(base_query.sum_qty) AS sum_qty, MAX(base_query.sum_base_price) AS sum_base_price, MAX(base_query.sum_disc_price) AS sum_disc_price, MAX(base_query.sum_charge) AS sum_charge, MAX(base_query.avg_qty) AS avg_qty, MAX(base_query.avg_price) AS avg_price, MAX(base_query.avg_disc) AS avg_disc, MAX(base_query.count_order) AS count_order FROM base_query, lineitem WHERE lineitem.l_shipdate <= CAST('1998-09-02' AS DATE) AND base_query.l_returnflag = lineitem.l_returnflag AND base_query.l_linestatus = lineitem.l_linestatus GROUP BY base_query.l_returnflag, base_query.l_linestatus HAVING (((((MAX(lineitem.l_quantity) > 0) AND (MAX(lineitem.l_quantity) > -1)) AND ((MAX(lineitem.l_quantity) > -2) AND (MAX(lineitem.l_quantity) > -3))) AND (((MAX(lineitem.l_quantity) > -4) AND (MAX(lineitem.l_quantity) > -5)) AND ((MAX(lineitem.l_quantity) > -6) AND (MAX(lineitem.l_quantity) > -7)))) AND ((MAX(lineitem.l_quantity) > -8) AND (MAX(lineitem.l_quantity) > -9))) ORDER BY base_query.l_returnflag, base_query.l_linestatus""",
    100: r"""WITH base_query AS (SELECT l_returnflag, l_linestatus, SUM(l_quantity) AS sum_qty, SUM(l_extendedprice) AS sum_base_price, SUM(l_extendedprice * (1 - l_discount)) AS sum_disc_price, SUM(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge, AVG(l_quantity) AS avg_qty, AVG(l_extendedprice) AS avg_price, AVG(l_discount) AS avg_disc, COUNT(*) AS count_order FROM lineitem WHERE l_shipdate <= CAST('1998-09-02' AS DATE) GROUP BY l_returnflag, l_linestatus) SELECT base_query.l_returnflag, base_query.l_linestatus, MAX(base_query.sum_qty) AS sum_qty, MAX(base_query.sum_base_price) AS sum_base_price, MAX(base_query.sum_disc_price) AS sum_disc_price, MAX(base_query.sum_charge) AS sum_charge, MAX(base_query.avg_qty) AS avg_qty, MAX(base_query.avg_price) AS avg_price, MAX(base_query.avg_disc) AS avg_disc, MAX(base_query.count_order) AS count_order FROM base_query, lineitem WHERE lineitem.l_shipdate <= CAST('1998-09-02' AS DATE) AND base_query.l_returnflag = lineitem.l_returnflag AND base_query.l_linestatus = lineitem.l_linestatus GROUP BY base_query.l_returnflag, base_query.l_linestatus HAVING ((((((((MAX(lineitem.l_quantity) > 0) AND (MAX(lineitem.l_quantity) > -1)) AND ((MAX(lineitem.l_quantity) > -2) AND (MAX(lineitem.l_quantity) > -3))) AND (((MAX(lineitem.l_quantity) > -4) AND (MAX(lineitem.l_quantity) > -5)) AND ((MAX(lineitem.l_quantity) > -6) AND (MAX(lineitem.l_quantity) > -7)))) AND ((((MAX(lineitem.l_quantity) > -8) AND (MAX(lineitem.l_quantity) > -9)) AND ((MAX(lineitem.l_quantity) > -10) AND (MAX(lineitem.l_quantity) > -11))) AND (((MAX(lineitem.l_quantity) > -12) AND (MAX(lineitem.l_quantity) > -13)) AND ((MAX(lineitem.l_quantity) > -14) AND (MAX(lineitem.l_quantity) > -15))))) AND (((((MAX(lineitem.l_quantity) > -16) AND (MAX(lineitem.l_quantity) > -17)) AND ((MAX(lineitem.l_quantity) > -18) AND (MAX(lineitem.l_quantity) > -19))) AND (((MAX(lineitem.l_quantity) > -20) AND (MAX(lineitem.l_quantity) > -21)) AND ((MAX(lineitem.l_quantity) > -22) AND (MAX(lineitem.l_quantity) > -23)))) AND ((((MAX(lineitem.l_quantity) > -24) AND (MAX(lineitem.l_quantity) > -25)) AND ((MAX(lineitem.l_quantity) > -26) AND (MAX(lineitem.l_quantity) > -27))) AND (((MAX(lineitem.l_quantity) > -28) AND (MAX(lineitem.l_quantity) > -29)) AND ((MAX(lineitem.l_quantity) > -30) AND (MAX(lineitem.l_quantity) > -31)))))) AND ((((((MAX(lineitem.l_quantity) > -32) AND (MAX(lineitem.l_quantity) > -33)) AND ((MAX(lineitem.l_quantity) > -34) AND (MAX(lineitem.l_quantity) > -35))) AND (((MAX(lineitem.l_quantity) > -36) AND (MAX(lineitem.l_quantity) > -37)) AND ((MAX(lineitem.l_quantity) > -38) AND (MAX(lineitem.l_quantity) > -39)))) AND ((((MAX(lineitem.l_quantity) > -40) AND (MAX(lineitem.l_quantity) > -41)) AND ((MAX(lineitem.l_quantity) > -42) AND (MAX(lineitem.l_quantity) > -43))) AND (((MAX(lineitem.l_quantity) > -44) AND (MAX(lineitem.l_quantity) > -45)) AND ((MAX(lineitem.l_quantity) > -46) AND (MAX(lineitem.l_quantity) > -47))))) AND (((((MAX(lineitem.l_quantity) > -48) AND (MAX(lineitem.l_quantity) > -49)) AND ((MAX(lineitem.l_quantity) > -50) AND (MAX(lineitem.l_quantity) > -51))) AND (((MAX(lineitem.l_quantity) > -52) AND (MAX(lineitem.l_quantity) > -53)) AND ((MAX(lineitem.l_quantity) > -54) AND (MAX(lineitem.l_quantity) > -55)))) AND ((((MAX(lineitem.l_quantity) > -56) AND (MAX(lineitem.l_quantity) > -57)) AND ((MAX(lineitem.l_quantity) > -58) AND (MAX(lineitem.l_quantity) > -59))) AND (((MAX(lineitem.l_quantity) > -60) AND (MAX(lineitem.l_quantity) > -61)) AND ((MAX(lineitem.l_quantity) > -62) AND (MAX(lineitem.l_quantity) > -63))))))) AND (((((((MAX(lineitem.l_quantity) > -64) AND (MAX(lineitem.l_quantity) > -65)) AND ((MAX(lineitem.l_quantity) > -66) AND (MAX(lineitem.l_quantity) > -67))) AND (((MAX(lineitem.l_quantity) > -68) AND (MAX(lineitem.l_quantity) > -69)) AND ((MAX(lineitem.l_quantity) > -70) AND (MAX(lineitem.l_quantity) > -71)))) AND ((((MAX(lineitem.l_quantity) > -72) AND (MAX(lineitem.l_quantity) > -73)) AND ((MAX(lineitem.l_quantity) > -74) AND (MAX(lineitem.l_quantity) > -75))) AND (((MAX(lineitem.l_quantity) > -76) AND (MAX(lineitem.l_quantity) > -77)) AND ((MAX(lineitem.l_quantity) > -78) AND (MAX(lineitem.l_quantity) > -79))))) AND (((((MAX(lineitem.l_quantity) > -80) AND (MAX(lineitem.l_quantity) > -81)) AND ((MAX(lineitem.l_quantity) > -82) AND (MAX(lineitem.l_quantity) > -83))) AND (((MAX(lineitem.l_quantity) > -84) AND (MAX(lineitem.l_quantity) > -85)) AND ((MAX(lineitem.l_quantity) > -86) AND (MAX(lineitem.l_quantity) > -87)))) AND ((((MAX(lineitem.l_quantity) > -88) AND (MAX(lineitem.l_quantity) > -89)) AND ((MAX(lineitem.l_quantity) > -90) AND (MAX(lineitem.l_quantity) > -91))) AND (((MAX(lineitem.l_quantity) > -92) AND (MAX(lineitem.l_quantity) > -93)) AND ((MAX(lineitem.l_quantity) > -94) AND (MAX(lineitem.l_quantity) > -95)))))) AND (((MAX(lineitem.l_quantity) > -96) AND (MAX(lineitem.l_quantity) > -97)) AND ((MAX(lineitem.l_quantity) > -98) AND (MAX(lineitem.l_quantity) > -99))))) ORDER BY base_query.l_returnflag, base_query.l_linestatus""",
    1000: r"""WITH base_query AS (SELECT l_returnflag, l_linestatus, SUM(l_quantity) AS sum_qty, SUM(l_extendedprice) AS sum_base_price, SUM(l_extendedprice * (1 - l_discount)) AS sum_disc_price, SUM(l_extendedprice * (1 - l_discount) * (1 + l_tax)) AS sum_charge, AVG(l_quantity) AS avg_qty, AVG(l_extendedprice) AS avg_price, AVG(l_discount) AS avg_disc, COUNT(*) AS count_order FROM lineitem WHERE l_shipdate <= CAST('1998-09-02' AS DATE) GROUP BY l_returnflag, l_linestatus) SELECT base_query.l_returnflag, base_query.l_linestatus, MAX(base_query.sum_qty) AS sum_qty, MAX(base_query.sum_base_price) AS sum_base_price, MAX(base_query.sum_disc_price) AS sum_disc_price, MAX(base_query.sum_charge) AS sum_charge, MAX(base_query.avg_qty) AS avg_qty, MAX(base_query.avg_price) AS avg_price, MAX(base_query.avg_disc) AS avg_disc, MAX(base_query.count_order) AS count_order FROM base_query, lineitem WHERE lineitem.l_shipdate <= CAST('1998-09-02' AS DATE) AND base_query.l_returnflag = lineitem.l_returnflag AND base_query.l_linestatus = lineitem.l_linestatus GROUP BY base_query.l_returnflag, base_query.l_linestatus HAVING (((((((((((MAX(lineitem.l_quantity) > 0) AND (MAX(lineitem.l_quantity) > -1)) AND ((MAX(lineitem.l_quantity) > -2) AND (MAX(lineitem.l_quantity) > -3))) AND (((MAX(lineitem.l_quantity) > -4) AND (MAX(lineitem.l_quantity) > -5)) AND ((MAX(lineitem.l_quantity) > -6) AND (MAX(lineitem.l_quantity) > -7)))) AND ((((MAX(lineitem.l_quantity) > -8) AND (MAX(lineitem.l_quantity) > -9)) AND ((MAX(lineitem.l_quantity) > -10) AND (MAX(lineitem.l_quantity) > -11))) AND (((MAX(lineitem.l_quantity) > -12) AND (MAX(lineitem.l_quantity) > -13)) AND ((MAX(lineitem.l_quantity) > -14) AND (MAX(lineitem.l_quantity) > -15))))) AND (((((MAX(lineitem.l_quantity) > -16) AND (MAX(lineitem.l_quantity) > -17)) AND ((MAX(lineitem.l_quantity) > -18) AND (MAX(lineitem.l_quantity) > -19))) AND (((MAX(lineitem.l_quantity) > -20) AND (MAX(lineitem.l_quantity) > -21)) AND ((MAX(lineitem.l_quantity) > -22) AND (MAX(lineitem.l_quantity) > -23)))) AND ((((MAX(lineitem.l_quantity) > -24) AND (MAX(lineitem.l_quantity) > -25)) AND ((MAX(lineitem.l_quantity) > -26) AND (MAX(lineitem.l_quantity) > -27))) AND (((MAX(lineitem.l_quantity) > -28) AND (MAX(lineitem.l_quantity) > -29)) AND ((MAX(lineitem.l_quantity) > -30) AND (MAX(lineitem.l_quantity) > -31)))))) AND ((((((MAX(lineitem.l_quantity) > -32) AND (MAX(lineitem.l_quantity) > -33)) AND ((MAX(lineitem.l_quantity) > -34) AND (MAX(lineitem.l_quantity) > -35))) AND (((MAX(lineitem.l_quantity) > -36) AND (MAX(lineitem.l_quantity) > -37)) AND ((MAX(lineitem.l_quantity) > -38) AND (MAX(lineitem.l_quantity) > -39)))) AND ((((MAX(lineitem.l_quantity) > -40) AND (MAX(lineitem.l_quantity) > -41)) AND ((MAX(lineitem.l_quantity) > -42) AND (MAX(lineitem.l_quantity) > -43))) AND (((MAX(lineitem.l_quantity) > -44) AND (MAX(lineitem.l_quantity) > -45)) AND ((MAX(lineitem.l_quantity) > -46) AND (MAX(lineitem.l_quantity) > -47))))) AND (((((MAX(lineitem.l_quantity) > -48) AND (MAX(lineitem.l_quantity) > -49)) AND ((MAX(lineitem.l_quantity) > -50) AND (MAX(lineitem.l_quantity) > -51))) AND (((MAX(lineitem.l_quantity) > -52) AND (MAX(lineitem.l_quantity) > -53)) AND ((MAX(lineitem.l_quantity) > -54) AND (MAX(lineitem.l_quantity) > -55)))) AND ((((MAX(lineitem.l_quantity) > -56) AND (MAX(lineitem.l_quantity) > -57)) AND ((MAX(lineitem.l_quantity) > -58) AND (MAX(lineitem.l_quantity) > -59))) AND (((MAX(lineitem.l_quantity) > -60) AND (MAX(lineitem.l_quantity) > -61)) AND ((MAX(lineitem.l_quantity) > -62) AND (MAX(lineitem.l_quantity) > -63))))))) AND (((((((MAX(lineitem.l_quantity) > -64) AND (MAX(lineitem.l_quantity) > -65)) AND ((MAX(lineitem.l_quantity) > -66) AND (MAX(lineitem.l_quantity) > -67))) AND (((MAX(lineitem.l_quantity) > -68) AND (MAX(lineitem.l_quantity) > -69)) AND ((MAX(lineitem.l_quantity) > -70) AND (MAX(lineitem.l_quantity) > -71)))) AND ((((MAX(lineitem.l_quantity) > -72) AND (MAX(lineitem.l_quantity) > -73)) AND ((MAX(lineitem.l_quantity) > -74) AND (MAX(lineitem.l_quantity) > -75))) AND (((MAX(lineitem.l_quantity) > -76) AND (MAX(lineitem.l_quantity) > -77)) AND ((MAX(lineitem.l_quantity) > -78) AND (MAX(lineitem.l_quantity) > -79))))) AND (((((MAX(lineitem.l_quantity) > -80) AND (MAX(lineitem.l_quantity) > -81)) AND ((MAX(lineitem.l_quantity) > -82) AND (MAX(lineitem.l_quantity) > -83))) AND (((MAX(lineitem.l_quantity) > -84) AND (MAX(lineitem.l_quantity) > -85)) AND ((MAX(lineitem.l_quantity) > -86) AND (MAX(lineitem.l_quantity) > -87)))) AND ((((MAX(lineitem.l_quantity) > -88) AND (MAX(lineitem.l_quantity) > -89)) AND ((MAX(lineitem.l_quantity) > -90) AND (MAX(lineitem.l_quantity) > -91))) AND (((MAX(lineitem.l_quantity) > -92) AND (MAX(lineitem.l_quantity) > -93)) AND ((MAX(lineitem.l_quantity) > -94) AND (MAX(lineitem.l_quantity) > -95)))))) AND ((((((MAX(lineitem.l_quantity) > -96) AND (MAX(lineitem.l_quantity) > -97)) AND ((MAX(lineitem.l_quantity) > -98) AND (MAX(lineitem.l_quantity) > -99))) AND (((MAX(lineitem.l_quantity) > -100) AND (MAX(lineitem.l_quantity) > -101)) AND ((MAX(lineitem.l_quantity) > -102) AND (MAX(lineitem.l_quantity) > -103)))) AND ((((MAX(lineitem.l_quantity) > -104) AND (MAX(lineitem.l_quantity) > -105)) AND ((MAX(lineitem.l_quantity) > -106) AND (MAX(lineitem.l_quantity) > -107))) AND (((MAX(lineitem.l_quantity) > -108) AND (MAX(lineitem.l_quantity) > -109)) AND ((MAX(lineitem.l_quantity) > -110) AND (MAX(lineitem.l_quantity) > -111))))) AND (((((MAX(lineitem.l_quantity) > -112) AND (MAX(lineitem.l_quantity) > -113)) AND ((MAX(lineitem.l_quantity) > -114) AND (MAX(lineitem.l_quantity) > -115))) AND (((MAX(lineitem.l_quantity) > -116) AND (MAX(lineitem.l_quantity) > -117)) AND ((MAX(lineitem.l_quantity) > -118) AND (MAX(lineitem.l_quantity) > -119)))) AND ((((MAX(lineitem.l_quantity) > -120) AND (MAX(lineitem.l_quantity) > -121)) AND ((MAX(lineitem.l_quantity) > -122) AND (MAX(lineitem.l_quantity) > -123))) AND (((MAX(lineitem.l_quantity) > -124) AND (MAX(lineitem.l_quantity) > -125)) AND ((MAX(lineitem.l_quantity) > -126) AND (MAX(lineitem.l_quantity) > -127)))))))) AND ((((((((MAX(lineitem.l_quantity) > -128) AND (MAX(lineitem.l_quantity) > -129)) AND ((MAX(lineitem.l_quantity) > -130) AND (MAX(lineitem.l_quantity) > -131))) AND (((MAX(lineitem.l_quantity) > -132) AND (MAX(lineitem.l_quantity) > -133)) AND ((MAX(lineitem.l_quantity) > -134) AND (MAX(lineitem.l_quantity) > -135)))) AND ((((MAX(lineitem.l_quantity) > -136) AND (MAX(lineitem.l_quantity) > -137)) AND ((MAX(lineitem.l_quantity) > -138) AND (MAX(lineitem.l_quantity) > -139))) AND (((MAX(lineitem.l_quantity) > -140) AND (MAX(lineitem.l_quantity) > -141)) AND ((MAX(lineitem.l_quantity) > -142) AND (MAX(lineitem.l_quantity) > -143))))) AND (((((MAX(lineitem.l_quantity) > -144) AND (MAX(lineitem.l_quantity) > -145)) AND ((MAX(lineitem.l_quantity) > -146) AND (MAX(lineitem.l_quantity) > -147))) AND (((MAX(lineitem.l_quantity) > -148) AND (MAX(lineitem.l_quantity) > -149)) AND ((MAX(lineitem.l_quantity) > -150) AND (MAX(lineitem.l_quantity) > -151)))) AND ((((MAX(lineitem.l_quantity) > -152) AND (MAX(lineitem.l_quantity) > -153)) AND ((MAX(lineitem.l_quantity) > -154) AND (MAX(lineitem.l_quantity) > -155))) AND (((MAX(lineitem.l_quantity) > -156) AND (MAX(lineitem.l_quantity) > -157)) AND ((MAX(lineitem.l_quantity) > -158) AND (MAX(lineitem.l_quantity) > -159)))))) AND ((((((MAX(lineitem.l_quantity) > -160) AND (MAX(lineitem.l_quantity) > -161)) AND ((MAX(lineitem.l_quantity) > -162) AND (MAX(lineitem.l_quantity) > -163))) AND (((MAX(lineitem.l_quantity) > -164) AND (MAX(lineitem.l_quantity) > -165)) AND ((MAX(lineitem.l_quantity) > -166) AND (MAX(lineitem.l_quantity) > -167)))) AND ((((MAX(lineitem.l_quantity) > -168) AND (MAX(lineitem.l_quantity) > -169)) AND ((MAX(lineitem.l_quantity) > -170) AND (MAX(lineitem.l_quantity) > -171))) AND (((MAX(lineitem.l_quantity) > -172) AND (MAX(lineitem.l_quantity) > -173)) AND ((MAX(lineitem.l_quantity) > -174) AND (MAX(lineitem.l_quantity) > -175))))) AND (((((MAX(lineitem.l_quantity) > -176) AND (MAX(lineitem.l_quantity) > -177)) AND ((MAX(lineitem.l_quantity) > -178) AND (MAX(lineitem.l_quantity) > -179))) AND (((MAX(lineitem.l_quantity) > -180) AND (MAX(lineitem.l_quantity) > -181)) AND ((MAX(lineitem.l_quantity) > -182) AND (MAX(lineitem.l_quantity) > -183)))) AND ((((MAX(lineitem.l_quantity) > -184) AND (MAX(lineitem.l_quantity) > -185)) AND ((MAX(lineitem.l_quantity) > -186) AND (MAX(lineitem.l_quantity) > -187))) AND (((MAX(lineitem.l_quantity) > -188) AND (MAX(lineitem.l_quantity) > -189)) AND ((MAX(lineitem.l_quantity) > -190) AND (MAX(lineitem.l_quantity) > -191))))))) AND (((((((MAX(lineitem.l_quantity) > -192) AND (MAX(lineitem.l_quantity) > -193)) AND ((MAX(lineitem.l_quantity) > -194) AND (MAX(lineitem.l_quantity) > -195))) AND (((MAX(lineitem.l_quantity) > -196) AND (MAX(lineitem.l_quantity) > -197)) AND ((MAX(lineitem.l_quantity) > -198) AND (MAX(lineitem.l_quantity) > -199)))) AND ((((MAX(lineitem.l_quantity) > -200) AND (MAX(lineitem.l_quantity) > -201)) AND ((MAX(lineitem.l_quantity) > -202) AND (MAX(lineitem.l_quantity) > -203))) AND (((MAX(lineitem.l_quantity) > -204) AND (MAX(lineitem.l_quantity) > -205)) AND ((MAX(lineitem.l_quantity) > -206) AND (MAX(lineitem.l_quantity) > -207))))) AND (((((MAX(lineitem.l_quantity) > -208) AND (MAX(lineitem.l_quantity) > -209)) AND ((MAX(lineitem.l_quantity) > -210) AND (MAX(lineitem.l_quantity) > -211))) AND (((MAX(lineitem.l_quantity) > -212) AND (MAX(lineitem.l_quantity) > -213)) AND ((MAX(lineitem.l_quantity) > -214) AND (MAX(lineitem.l_quantity) > -215)))) AND ((((MAX(lineitem.l_quantity) > -216) AND (MAX(lineitem.l_quantity) > -217)) AND ((MAX(lineitem.l_quantity) > -218) AND (MAX(lineitem.l_quantity) > -219))) AND (((MAX(lineitem.l_quantity) > -220) AND (MAX(lineitem.l_quantity) > -221)) AND ((MAX(lineitem.l_quantity) > -222) AND (MAX(lineitem.l_quantity) > -223)))))) AND ((((((MAX(lineitem.l_quantity) > -224) AND (MAX(lineitem.l_quantity) > -225)) AND ((MAX(lineitem.l_quantity) > -226) AND (MAX(lineitem.l_quantity) > -227))) AND (((MAX(lineitem.l_quantity) > -228) AND (MAX(lineitem.l_quantity) > -229)) AND ((MAX(lineitem.l_quantity) > -230) AND (MAX(lineitem.l_quantity) > -231)))) AND ((((MAX(lineitem.l_quantity) > -232) AND (MAX(lineitem.l_quantity) > -233)) AND ((MAX(lineitem.l_quantity) > -234) AND (MAX(lineitem.l_quantity) > -235))) AND (((MAX(lineitem.l_quantity) > -236) AND (MAX(lineitem.l_quantity) > -237)) AND ((MAX(lineitem.l_quantity) > -238) AND (MAX(lineitem.l_quantity) > -239))))) AND (((((MAX(lineitem.l_quantity) > -240) AND (MAX(lineitem.l_quantity) > -241)) AND ((MAX(lineitem.l_quantity) > -242) AND (MAX(lineitem.l_quantity) > -243))) AND (((MAX(lineitem.l_quantity) > -244) AND (MAX(lineitem.l_quantity) > -245)) AND ((MAX(lineitem.l_quantity) > -246) AND (MAX(lineitem.l_quantity) > -247)))) AND ((((MAX(lineitem.l_quantity) > -248) AND (MAX(lineitem.l_quantity) > -249)) AND ((MAX(lineitem.l_quantity) > -250) AND (MAX(lineitem.l_quantity) > -251))) AND (((MAX(lineitem.l_quantity) > -252) AND (MAX(lineitem.l_quantity) > -253)) AND ((MAX(lineitem.l_quantity) > -254) AND (MAX(lineitem.l_quantity) > -255))))))))) AND (((((((((MAX(lineitem.l_quantity) > -256) AND (MAX(lineitem.l_quantity) > -257)) AND ((MAX(lineitem.l_quantity) > -258) AND (MAX(lineitem.l_quantity) > -259))) AND (((MAX(lineitem.l_quantity) > -260) AND (MAX(lineitem.l_quantity) > -261)) AND ((MAX(lineitem.l_quantity) > -262) AND (MAX(lineitem.l_quantity) > -263)))) AND ((((MAX(lineitem.l_quantity) > -264) AND (MAX(lineitem.l_quantity) > -265)) AND ((MAX(lineitem.l_quantity) > -266) AND (MAX(lineitem.l_quantity) > -267))) AND (((MAX(lineitem.l_quantity) > -268) AND (MAX(lineitem.l_quantity) > -269)) AND ((MAX(lineitem.l_quantity) > -270) AND (MAX(lineitem.l_quantity) > -271))))) AND (((((MAX(lineitem.l_quantity) > -272) AND (MAX(lineitem.l_quantity) > -273)) AND ((MAX(lineitem.l_quantity) > -274) AND (MAX(lineitem.l_quantity) > -275))) AND (((MAX(lineitem.l_quantity) > -276) AND (MAX(lineitem.l_quantity) > -277)) AND ((MAX(lineitem.l_quantity) > -278) AND (MAX(lineitem.l_quantity) > -279)))) AND ((((MAX(lineitem.l_quantity) > -280) AND (MAX(lineitem.l_quantity) > -281)) AND ((MAX(lineitem.l_quantity) > -282) AND (MAX(lineitem.l_quantity) > -283))) AND (((MAX(lineitem.l_quantity) > -284) AND (MAX(lineitem.l_quantity) > -285)) AND ((MAX(lineitem.l_quantity) > -286) AND (MAX(lineitem.l_quantity) > -287)))))) AND ((((((MAX(lineitem.l_quantity) > -288) AND (MAX(lineitem.l_quantity) > -289)) AND ((MAX(lineitem.l_quantity) > -290) AND (MAX(lineitem.l_quantity) > -291))) AND (((MAX(lineitem.l_quantity) > -292) AND (MAX(lineitem.l_quantity) > -293)) AND ((MAX(lineitem.l_quantity) > -294) AND (MAX(lineitem.l_quantity) > -295)))) AND ((((MAX(lineitem.l_quantity) > -296) AND (MAX(lineitem.l_quantity) > -297)) AND ((MAX(lineitem.l_quantity) > -298) AND (MAX(lineitem.l_quantity) > -299))) AND (((MAX(lineitem.l_quantity) > -300) AND (MAX(lineitem.l_quantity) > -301)) AND ((MAX(lineitem.l_quantity) > -302) AND (MAX(lineitem.l_quantity) > -303))))) AND (((((MAX(lineitem.l_quantity) > -304) AND (MAX(lineitem.l_quantity) > -305)) AND ((MAX(lineitem.l_quantity) > -306) AND (MAX(lineitem.l_quantity) > -307))) AND (((MAX(lineitem.l_quantity) > -308) AND (MAX(lineitem.l_quantity) > -309)) AND ((MAX(lineitem.l_quantity) > -310) AND (MAX(lineitem.l_quantity) > -311)))) AND ((((MAX(lineitem.l_quantity) > -312) AND (MAX(lineitem.l_quantity) > -313)) AND ((MAX(lineitem.l_quantity) > -314) AND (MAX(lineitem.l_quantity) > -315))) AND (((MAX(lineitem.l_quantity) > -316) AND (MAX(lineitem.l_quantity) > -317)) AND ((MAX(lineitem.l_quantity) > -318) AND (MAX(lineitem.l_quantity) > -319))))))) AND (((((((MAX(lineitem.l_quantity) > -320) AND (MAX(lineitem.l_quantity) > -321)) AND ((MAX(lineitem.l_quantity) > -322) AND (MAX(lineitem.l_quantity) > -323))) AND (((MAX(lineitem.l_quantity) > -324) AND (MAX(lineitem.l_quantity) > -325)) AND ((MAX(lineitem.l_quantity) > -326) AND (MAX(lineitem.l_quantity) > -327)))) AND ((((MAX(lineitem.l_quantity) > -328) AND (MAX(lineitem.l_quantity) > -329)) AND ((MAX(lineitem.l_quantity) > -330) AND (MAX(lineitem.l_quantity) > -331))) AND (((MAX(lineitem.l_quantity) > -332) AND (MAX(lineitem.l_quantity) > -333)) AND ((MAX(lineitem.l_quantity) > -334) AND (MAX(lineitem.l_quantity) > -335))))) AND (((((MAX(lineitem.l_quantity) > -336) AND (MAX(lineitem.l_quantity) > -337)) AND ((MAX(lineitem.l_quantity) > -338) AND (MAX(lineitem.l_quantity) > -339))) AND (((MAX(lineitem.l_quantity) > -340) AND (MAX(lineitem.l_quantity) > -341)) AND ((MAX(lineitem.l_quantity) > -342) AND (MAX(lineitem.l_quantity) > -343)))) AND ((((MAX(lineitem.l_quantity) > -344) AND (MAX(lineitem.l_quantity) > -345)) AND ((MAX(lineitem.l_quantity) > -346) AND (MAX(lineitem.l_quantity) > -347))) AND (((MAX(lineitem.l_quantity) > -348) AND (MAX(lineitem.l_quantity) > -349)) AND ((MAX(lineitem.l_quantity) > -350) AND (MAX(lineitem.l_quantity) > -351)))))) AND ((((((MAX(lineitem.l_quantity) > -352) AND (MAX(lineitem.l_quantity) > -353)) AND ((MAX(lineitem.l_quantity) > -354) AND (MAX(lineitem.l_quantity) > -355))) AND (((MAX(lineitem.l_quantity) > -356) AND (MAX(lineitem.l_quantity) > -357)) AND ((MAX(lineitem.l_quantity) > -358) AND (MAX(lineitem.l_quantity) > -359)))) AND ((((MAX(lineitem.l_quantity) > -360) AND (MAX(lineitem.l_quantity) > -361)) AND ((MAX(lineitem.l_quantity) > -362) AND (MAX(lineitem.l_quantity) > -363))) AND (((MAX(lineitem.l_quantity) > -364) AND (MAX(lineitem.l_quantity) > -365)) AND ((MAX(lineitem.l_quantity) > -366) AND (MAX(lineitem.l_quantity) > -367))))) AND (((((MAX(lineitem.l_quantity) > -368) AND (MAX(lineitem.l_quantity) > -369)) AND ((MAX(lineitem.l_quantity) > -370) AND (MAX(lineitem.l_quantity) > -371))) AND (((MAX(lineitem.l_quantity) > -372) AND (MAX(lineitem.l_quantity) > -373)) AND ((MAX(lineitem.l_quantity) > -374) AND (MAX(lineitem.l_quantity) > -375)))) AND ((((MAX(lineitem.l_quantity) > -376) AND (MAX(lineitem.l_quantity) > -377)) AND ((MAX(lineitem.l_quantity) > -378) AND (MAX(lineitem.l_quantity) > -379))) AND (((MAX(lineitem.l_quantity) > -380) AND (MAX(lineitem.l_quantity) > -381)) AND ((MAX(lineitem.l_quantity) > -382) AND (MAX(lineitem.l_quantity) > -383)))))))) AND ((((((((MAX(lineitem.l_quantity) > -384) AND (MAX(lineitem.l_quantity) > -385)) AND ((MAX(lineitem.l_quantity) > -386) AND (MAX(lineitem.l_quantity) > -387))) AND (((MAX(lineitem.l_quantity) > -388) AND (MAX(lineitem.l_quantity) > -389)) AND ((MAX(lineitem.l_quantity) > -390) AND (MAX(lineitem.l_quantity) > -391)))) AND ((((MAX(lineitem.l_quantity) > -392) AND (MAX(lineitem.l_quantity) > -393)) AND ((MAX(lineitem.l_quantity) > -394) AND (MAX(lineitem.l_quantity) > -395))) AND (((MAX(lineitem.l_quantity) > -396) AND (MAX(lineitem.l_quantity) > -397)) AND ((MAX(lineitem.l_quantity) > -398) AND (MAX(lineitem.l_quantity) > -399))))) AND (((((MAX(lineitem.l_quantity) > -400) AND (MAX(lineitem.l_quantity) > -401)) AND ((MAX(lineitem.l_quantity) > -402) AND (MAX(lineitem.l_quantity) > -403))) AND (((MAX(lineitem.l_quantity) > -404) AND (MAX(lineitem.l_quantity) > -405)) AND ((MAX(lineitem.l_quantity) > -406) AND (MAX(lineitem.l_quantity) > -407)))) AND ((((MAX(lineitem.l_quantity) > -408) AND (MAX(lineitem.l_quantity) > -409)) AND ((MAX(lineitem.l_quantity) > -410) AND (MAX(lineitem.l_quantity) > -411))) AND (((MAX(lineitem.l_quantity) > -412) AND (MAX(lineitem.l_quantity) > -413)) AND ((MAX(lineitem.l_quantity) > -414) AND (MAX(lineitem.l_quantity) > -415)))))) AND ((((((MAX(lineitem.l_quantity) > -416) AND (MAX(lineitem.l_quantity) > -417)) AND ((MAX(lineitem.l_quantity) > -418) AND (MAX(lineitem.l_quantity) > -419))) AND (((MAX(lineitem.l_quantity) > -420) AND (MAX(lineitem.l_quantity) > -421)) AND ((MAX(lineitem.l_quantity) > -422) AND (MAX(lineitem.l_quantity) > -423)))) AND ((((MAX(lineitem.l_quantity) > -424) AND (MAX(lineitem.l_quantity) > -425)) AND ((MAX(lineitem.l_quantity) > -426) AND (MAX(lineitem.l_quantity) > -427))) AND (((MAX(lineitem.l_quantity) > -428) AND (MAX(lineitem.l_quantity) > -429)) AND ((MAX(lineitem.l_quantity) > -430) AND (MAX(lineitem.l_quantity) > -431))))) AND (((((MAX(lineitem.l_quantity) > -432) AND (MAX(lineitem.l_quantity) > -433)) AND ((MAX(lineitem.l_quantity) > -434) AND (MAX(lineitem.l_quantity) > -435))) AND (((MAX(lineitem.l_quantity) > -436) AND (MAX(lineitem.l_quantity) > -437)) AND ((MAX(lineitem.l_quantity) > -438) AND (MAX(lineitem.l_quantity) > -439)))) AND ((((MAX(lineitem.l_quantity) > -440) AND (MAX(lineitem.l_quantity) > -441)) AND ((MAX(lineitem.l_quantity) > -442) AND (MAX(lineitem.l_quantity) > -443))) AND (((MAX(lineitem.l_quantity) > -444) AND (MAX(lineitem.l_quantity) > -445)) AND ((MAX(lineitem.l_quantity) > -446) AND (MAX(lineitem.l_quantity) > -447))))))) AND (((((((MAX(lineitem.l_quantity) > -448) AND (MAX(lineitem.l_quantity) > -449)) AND ((MAX(lineitem.l_quantity) > -450) AND (MAX(lineitem.l_quantity) > -451))) AND (((MAX(lineitem.l_quantity) > -452) AND (MAX(lineitem.l_quantity) > -453)) AND ((MAX(lineitem.l_quantity) > -454) AND (MAX(lineitem.l_quantity) > -455)))) AND ((((MAX(lineitem.l_quantity) > -456) AND (MAX(lineitem.l_quantity) > -457)) AND ((MAX(lineitem.l_quantity) > -458) AND (MAX(lineitem.l_quantity) > -459))) AND (((MAX(lineitem.l_quantity) > -460) AND (MAX(lineitem.l_quantity) > -461)) AND ((MAX(lineitem.l_quantity) > -462) AND (MAX(lineitem.l_quantity) > -463))))) AND (((((MAX(lineitem.l_quantity) > -464) AND (MAX(lineitem.l_quantity) > -465)) AND ((MAX(lineitem.l_quantity) > -466) AND (MAX(lineitem.l_quantity) > -467))) AND (((MAX(lineitem.l_quantity) > -468) AND (MAX(lineitem.l_quantity) > -469)) AND ((MAX(lineitem.l_quantity) > -470) AND (MAX(lineitem.l_quantity) > -471)))) AND ((((MAX(lineitem.l_quantity) > -472) AND (MAX(lineitem.l_quantity) > -473)) AND ((MAX(lineitem.l_quantity) > -474) AND (MAX(lineitem.l_quantity) > -475))) AND (((MAX(lineitem.l_quantity) > -476) AND (MAX(lineitem.l_quantity) > -477)) AND ((MAX(lineitem.l_quantity) > -478) AND (MAX(lineitem.l_quantity) > -479)))))) AND ((((((MAX(lineitem.l_quantity) > -480) AND (MAX(lineitem.l_quantity) > -481)) AND ((MAX(lineitem.l_quantity) > -482) AND (MAX(lineitem.l_quantity) > -483))) AND (((MAX(lineitem.l_quantity) > -484) AND (MAX(lineitem.l_quantity) > -485)) AND ((MAX(lineitem.l_quantity) > -486) AND (MAX(lineitem.l_quantity) > -487)))) AND ((((MAX(lineitem.l_quantity) > -488) AND (MAX(lineitem.l_quantity) > -489)) AND ((MAX(lineitem.l_quantity) > -490) AND (MAX(lineitem.l_quantity) > -491))) AND (((MAX(lineitem.l_quantity) > -492) AND (MAX(lineitem.l_quantity) > -493)) AND ((MAX(lineitem.l_quantity) > -494) AND (MAX(lineitem.l_quantity) > -495))))) AND (((((MAX(lineitem.l_quantity) > -496) AND (MAX(lineitem.l_quantity) > -497)) AND ((MAX(lineitem.l_quantity) > -498) AND (MAX(lineitem.l_quantity) > -499))) AND (((MAX(lineitem.l_quantity) > -500) AND (MAX(lineitem.l_quantity) > -501)) AND ((MAX(lineitem.l_quantity) > -502) AND (MAX(lineitem.l_quantity) > -503)))) AND ((((MAX(lineitem.l_quantity) > -504) AND (MAX(lineitem.l_quantity) > -505)) AND ((MAX(lineitem.l_quantity) > -506) AND (MAX(lineitem.l_quantity) > -507))) AND (((MAX(lineitem.l_quantity) > -508) AND (MAX(lineitem.l_quantity) > -509)) AND ((MAX(lineitem.l_quantity) > -510) AND (MAX(lineitem.l_quantity) > -511)))))))))) AND ((((((((((MAX(lineitem.l_quantity) > -512) AND (MAX(lineitem.l_quantity) > -513)) AND ((MAX(lineitem.l_quantity) > -514) AND (MAX(lineitem.l_quantity) > -515))) AND (((MAX(lineitem.l_quantity) > -516) AND (MAX(lineitem.l_quantity) > -517)) AND ((MAX(lineitem.l_quantity) > -518) AND (MAX(lineitem.l_quantity) > -519)))) AND ((((MAX(lineitem.l_quantity) > -520) AND (MAX(lineitem.l_quantity) > -521)) AND ((MAX(lineitem.l_quantity) > -522) AND (MAX(lineitem.l_quantity) > -523))) AND (((MAX(lineitem.l_quantity) > -524) AND (MAX(lineitem.l_quantity) > -525)) AND ((MAX(lineitem.l_quantity) > -526) AND (MAX(lineitem.l_quantity) > -527))))) AND (((((MAX(lineitem.l_quantity) > -528) AND (MAX(lineitem.l_quantity) > -529)) AND ((MAX(lineitem.l_quantity) > -530) AND (MAX(lineitem.l_quantity) > -531))) AND (((MAX(lineitem.l_quantity) > -532) AND (MAX(lineitem.l_quantity) > -533)) AND ((MAX(lineitem.l_quantity) > -534) AND (MAX(lineitem.l_quantity) > -535)))) AND ((((MAX(lineitem.l_quantity) > -536) AND (MAX(lineitem.l_quantity) > -537)) AND ((MAX(lineitem.l_quantity) > -538) AND (MAX(lineitem.l_quantity) > -539))) AND (((MAX(lineitem.l_quantity) > -540) AND (MAX(lineitem.l_quantity) > -541)) AND ((MAX(lineitem.l_quantity) > -542) AND (MAX(lineitem.l_quantity) > -543)))))) AND ((((((MAX(lineitem.l_quantity) > -544) AND (MAX(lineitem.l_quantity) > -545)) AND ((MAX(lineitem.l_quantity) > -546) AND (MAX(lineitem.l_quantity) > -547))) AND (((MAX(lineitem.l_quantity) > -548) AND (MAX(lineitem.l_quantity) > -549)) AND ((MAX(lineitem.l_quantity) > -550) AND (MAX(lineitem.l_quantity) > -551)))) AND ((((MAX(lineitem.l_quantity) > -552) AND (MAX(lineitem.l_quantity) > -553)) AND ((MAX(lineitem.l_quantity) > -554) AND (MAX(lineitem.l_quantity) > -555))) AND (((MAX(lineitem.l_quantity) > -556) AND (MAX(lineitem.l_quantity) > -557)) AND ((MAX(lineitem.l_quantity) > -558) AND (MAX(lineitem.l_quantity) > -559))))) AND (((((MAX(lineitem.l_quantity) > -560) AND (MAX(lineitem.l_quantity) > -561)) AND ((MAX(lineitem.l_quantity) > -562) AND (MAX(lineitem.l_quantity) > -563))) AND (((MAX(lineitem.l_quantity) > -564) AND (MAX(lineitem.l_quantity) > -565)) AND ((MAX(lineitem.l_quantity) > -566) AND (MAX(lineitem.l_quantity) > -567)))) AND ((((MAX(lineitem.l_quantity) > -568) AND (MAX(lineitem.l_quantity) > -569)) AND ((MAX(lineitem.l_quantity) > -570) AND (MAX(lineitem.l_quantity) > -571))) AND (((MAX(lineitem.l_quantity) > -572) AND (MAX(lineitem.l_quantity) > -573)) AND ((MAX(lineitem.l_quantity) > -574) AND (MAX(lineitem.l_quantity) > -575))))))) AND (((((((MAX(lineitem.l_quantity) > -576) AND (MAX(lineitem.l_quantity) > -577)) AND ((MAX(lineitem.l_quantity) > -578) AND (MAX(lineitem.l_quantity) > -579))) AND (((MAX(lineitem.l_quantity) > -580) AND (MAX(lineitem.l_quantity) > -581)) AND ((MAX(lineitem.l_quantity) > -582) AND (MAX(lineitem.l_quantity) > -583)))) AND ((((MAX(lineitem.l_quantity) > -584) AND (MAX(lineitem.l_quantity) > -585)) AND ((MAX(lineitem.l_quantity) > -586) AND (MAX(lineitem.l_quantity) > -587))) AND (((MAX(lineitem.l_quantity) > -588) AND (MAX(lineitem.l_quantity) > -589)) AND ((MAX(lineitem.l_quantity) > -590) AND (MAX(lineitem.l_quantity) > -591))))) AND (((((MAX(lineitem.l_quantity) > -592) AND (MAX(lineitem.l_quantity) > -593)) AND ((MAX(lineitem.l_quantity) > -594) AND (MAX(lineitem.l_quantity) > -595))) AND (((MAX(lineitem.l_quantity) > -596) AND (MAX(lineitem.l_quantity) > -597)) AND ((MAX(lineitem.l_quantity) > -598) AND (MAX(lineitem.l_quantity) > -599)))) AND ((((MAX(lineitem.l_quantity) > -600) AND (MAX(lineitem.l_quantity) > -601)) AND ((MAX(lineitem.l_quantity) > -602) AND (MAX(lineitem.l_quantity) > -603))) AND (((MAX(lineitem.l_quantity) > -604) AND (MAX(lineitem.l_quantity) > -605)) AND ((MAX(lineitem.l_quantity) > -606) AND (MAX(lineitem.l_quantity) > -607)))))) AND ((((((MAX(lineitem.l_quantity) > -608) AND (MAX(lineitem.l_quantity) > -609)) AND ((MAX(lineitem.l_quantity) > -610) AND (MAX(lineitem.l_quantity) > -611))) AND (((MAX(lineitem.l_quantity) > -612) AND (MAX(lineitem.l_quantity) > -613)) AND ((MAX(lineitem.l_quantity) > -614) AND (MAX(lineitem.l_quantity) > -615)))) AND ((((MAX(lineitem.l_quantity) > -616) AND (MAX(lineitem.l_quantity) > -617)) AND ((MAX(lineitem.l_quantity) > -618) AND (MAX(lineitem.l_quantity) > -619))) AND (((MAX(lineitem.l_quantity) > -620) AND (MAX(lineitem.l_quantity) > -621)) AND ((MAX(lineitem.l_quantity) > -622) AND (MAX(lineitem.l_quantity) > -623))))) AND (((((MAX(lineitem.l_quantity) > -624) AND (MAX(lineitem.l_quantity) > -625)) AND ((MAX(lineitem.l_quantity) > -626) AND (MAX(lineitem.l_quantity) > -627))) AND (((MAX(lineitem.l_quantity) > -628) AND (MAX(lineitem.l_quantity) > -629)) AND ((MAX(lineitem.l_quantity) > -630) AND (MAX(lineitem.l_quantity) > -631)))) AND ((((MAX(lineitem.l_quantity) > -632) AND (MAX(lineitem.l_quantity) > -633)) AND ((MAX(lineitem.l_quantity) > -634) AND (MAX(lineitem.l_quantity) > -635))) AND (((MAX(lineitem.l_quantity) > -636) AND (MAX(lineitem.l_quantity) > -637)) AND ((MAX(lineitem.l_quantity) > -638) AND (MAX(lineitem.l_quantity) > -639)))))))) AND ((((((((MAX(lineitem.l_quantity) > -640) AND (MAX(lineitem.l_quantity) > -641)) AND ((MAX(lineitem.l_quantity) > -642) AND (MAX(lineitem.l_quantity) > -643))) AND (((MAX(lineitem.l_quantity) > -644) AND (MAX(lineitem.l_quantity) > -645)) AND ((MAX(lineitem.l_quantity) > -646) AND (MAX(lineitem.l_quantity) > -647)))) AND ((((MAX(lineitem.l_quantity) > -648) AND (MAX(lineitem.l_quantity) > -649)) AND ((MAX(lineitem.l_quantity) > -650) AND (MAX(lineitem.l_quantity) > -651))) AND (((MAX(lineitem.l_quantity) > -652) AND (MAX(lineitem.l_quantity) > -653)) AND ((MAX(lineitem.l_quantity) > -654) AND (MAX(lineitem.l_quantity) > -655))))) AND (((((MAX(lineitem.l_quantity) > -656) AND (MAX(lineitem.l_quantity) > -657)) AND ((MAX(lineitem.l_quantity) > -658) AND (MAX(lineitem.l_quantity) > -659))) AND (((MAX(lineitem.l_quantity) > -660) AND (MAX(lineitem.l_quantity) > -661)) AND ((MAX(lineitem.l_quantity) > -662) AND (MAX(lineitem.l_quantity) > -663)))) AND ((((MAX(lineitem.l_quantity) > -664) AND (MAX(lineitem.l_quantity) > -665)) AND ((MAX(lineitem.l_quantity) > -666) AND (MAX(lineitem.l_quantity) > -667))) AND (((MAX(lineitem.l_quantity) > -668) AND (MAX(lineitem.l_quantity) > -669)) AND ((MAX(lineitem.l_quantity) > -670) AND (MAX(lineitem.l_quantity) > -671)))))) AND ((((((MAX(lineitem.l_quantity) > -672) AND (MAX(lineitem.l_quantity) > -673)) AND ((MAX(lineitem.l_quantity) > -674) AND (MAX(lineitem.l_quantity) > -675))) AND (((MAX(lineitem.l_quantity) > -676) AND (MAX(lineitem.l_quantity) > -677)) AND ((MAX(lineitem.l_quantity) > -678) AND (MAX(lineitem.l_quantity) > -679)))) AND ((((MAX(lineitem.l_quantity) > -680) AND (MAX(lineitem.l_quantity) > -681)) AND ((MAX(lineitem.l_quantity) > -682) AND (MAX(lineitem.l_quantity) > -683))) AND (((MAX(lineitem.l_quantity) > -684) AND (MAX(lineitem.l_quantity) > -685)) AND ((MAX(lineitem.l_quantity) > -686) AND (MAX(lineitem.l_quantity) > -687))))) AND (((((MAX(lineitem.l_quantity) > -688) AND (MAX(lineitem.l_quantity) > -689)) AND ((MAX(lineitem.l_quantity) > -690) AND (MAX(lineitem.l_quantity) > -691))) AND (((MAX(lineitem.l_quantity) > -692) AND (MAX(lineitem.l_quantity) > -693)) AND ((MAX(lineitem.l_quantity) > -694) AND (MAX(lineitem.l_quantity) > -695)))) AND ((((MAX(lineitem.l_quantity) > -696) AND (MAX(lineitem.l_quantity) > -697)) AND ((MAX(lineitem.l_quantity) > -698) AND (MAX(lineitem.l_quantity) > -699))) AND (((MAX(lineitem.l_quantity) > -700) AND (MAX(lineitem.l_quantity) > -701)) AND ((MAX(lineitem.l_quantity) > -702) AND (MAX(lineitem.l_quantity) > -703))))))) AND (((((((MAX(lineitem.l_quantity) > -704) AND (MAX(lineitem.l_quantity) > -705)) AND ((MAX(lineitem.l_quantity) > -706) AND (MAX(lineitem.l_quantity) > -707))) AND (((MAX(lineitem.l_quantity) > -708) AND (MAX(lineitem.l_quantity) > -709)) AND ((MAX(lineitem.l_quantity) > -710) AND (MAX(lineitem.l_quantity) > -711)))) AND ((((MAX(lineitem.l_quantity) > -712) AND (MAX(lineitem.l_quantity) > -713)) AND ((MAX(lineitem.l_quantity) > -714) AND (MAX(lineitem.l_quantity) > -715))) AND (((MAX(lineitem.l_quantity) > -716) AND (MAX(lineitem.l_quantity) > -717)) AND ((MAX(lineitem.l_quantity) > -718) AND (MAX(lineitem.l_quantity) > -719))))) AND (((((MAX(lineitem.l_quantity) > -720) AND (MAX(lineitem.l_quantity) > -721)) AND ((MAX(lineitem.l_quantity) > -722) AND (MAX(lineitem.l_quantity) > -723))) AND (((MAX(lineitem.l_quantity) > -724) AND (MAX(lineitem.l_quantity) > -725)) AND ((MAX(lineitem.l_quantity) > -726) AND (MAX(lineitem.l_quantity) > -727)))) AND ((((MAX(lineitem.l_quantity) > -728) AND (MAX(lineitem.l_quantity) > -729)) AND ((MAX(lineitem.l_quantity) > -730) AND (MAX(lineitem.l_quantity) > -731))) AND (((MAX(lineitem.l_quantity) > -732) AND (MAX(lineitem.l_quantity) > -733)) AND ((MAX(lineitem.l_quantity) > -734) AND (MAX(lineitem.l_quantity) > -735)))))) AND ((((((MAX(lineitem.l_quantity) > -736) AND (MAX(lineitem.l_quantity) > -737)) AND ((MAX(lineitem.l_quantity) > -738) AND (MAX(lineitem.l_quantity) > -739))) AND (((MAX(lineitem.l_quantity) > -740) AND (MAX(lineitem.l_quantity) > -741)) AND ((MAX(lineitem.l_quantity) > -742) AND (MAX(lineitem.l_quantity) > -743)))) AND ((((MAX(lineitem.l_quantity) > -744) AND (MAX(lineitem.l_quantity) > -745)) AND ((MAX(lineitem.l_quantity) > -746) AND (MAX(lineitem.l_quantity) > -747))) AND (((MAX(lineitem.l_quantity) > -748) AND (MAX(lineitem.l_quantity) > -749)) AND ((MAX(lineitem.l_quantity) > -750) AND (MAX(lineitem.l_quantity) > -751))))) AND (((((MAX(lineitem.l_quantity) > -752) AND (MAX(lineitem.l_quantity) > -753)) AND ((MAX(lineitem.l_quantity) > -754) AND (MAX(lineitem.l_quantity) > -755))) AND (((MAX(lineitem.l_quantity) > -756) AND (MAX(lineitem.l_quantity) > -757)) AND ((MAX(lineitem.l_quantity) > -758) AND (MAX(lineitem.l_quantity) > -759)))) AND ((((MAX(lineitem.l_quantity) > -760) AND (MAX(lineitem.l_quantity) > -761)) AND ((MAX(lineitem.l_quantity) > -762) AND (MAX(lineitem.l_quantity) > -763))) AND (((MAX(lineitem.l_quantity) > -764) AND (MAX(lineitem.l_quantity) > -765)) AND ((MAX(lineitem.l_quantity) > -766) AND (MAX(lineitem.l_quantity) > -767))))))))) AND (((((((((MAX(lineitem.l_quantity) > -768) AND (MAX(lineitem.l_quantity) > -769)) AND ((MAX(lineitem.l_quantity) > -770) AND (MAX(lineitem.l_quantity) > -771))) AND (((MAX(lineitem.l_quantity) > -772) AND (MAX(lineitem.l_quantity) > -773)) AND ((MAX(lineitem.l_quantity) > -774) AND (MAX(lineitem.l_quantity) > -775)))) AND ((((MAX(lineitem.l_quantity) > -776) AND (MAX(lineitem.l_quantity) > -777)) AND ((MAX(lineitem.l_quantity) > -778) AND (MAX(lineitem.l_quantity) > -779))) AND (((MAX(lineitem.l_quantity) > -780) AND (MAX(lineitem.l_quantity) > -781)) AND ((MAX(lineitem.l_quantity) > -782) AND (MAX(lineitem.l_quantity) > -783))))) AND (((((MAX(lineitem.l_quantity) > -784) AND (MAX(lineitem.l_quantity) > -785)) AND ((MAX(lineitem.l_quantity) > -786) AND (MAX(lineitem.l_quantity) > -787))) AND (((MAX(lineitem.l_quantity) > -788) AND (MAX(lineitem.l_quantity) > -789)) AND ((MAX(lineitem.l_quantity) > -790) AND (MAX(lineitem.l_quantity) > -791)))) AND ((((MAX(lineitem.l_quantity) > -792) AND (MAX(lineitem.l_quantity) > -793)) AND ((MAX(lineitem.l_quantity) > -794) AND (MAX(lineitem.l_quantity) > -795))) AND (((MAX(lineitem.l_quantity) > -796) AND (MAX(lineitem.l_quantity) > -797)) AND ((MAX(lineitem.l_quantity) > -798) AND (MAX(lineitem.l_quantity) > -799)))))) AND ((((((MAX(lineitem.l_quantity) > -800) AND (MAX(lineitem.l_quantity) > -801)) AND ((MAX(lineitem.l_quantity) > -802) AND (MAX(lineitem.l_quantity) > -803))) AND (((MAX(lineitem.l_quantity) > -804) AND (MAX(lineitem.l_quantity) > -805)) AND ((MAX(lineitem.l_quantity) > -806) AND (MAX(lineitem.l_quantity) > -807)))) AND ((((MAX(lineitem.l_quantity) > -808) AND (MAX(lineitem.l_quantity) > -809)) AND ((MAX(lineitem.l_quantity) > -810) AND (MAX(lineitem.l_quantity) > -811))) AND (((MAX(lineitem.l_quantity) > -812) AND (MAX(lineitem.l_quantity) > -813)) AND ((MAX(lineitem.l_quantity) > -814) AND (MAX(lineitem.l_quantity) > -815))))) AND (((((MAX(lineitem.l_quantity) > -816) AND (MAX(lineitem.l_quantity) > -817)) AND ((MAX(lineitem.l_quantity) > -818) AND (MAX(lineitem.l_quantity) > -819))) AND (((MAX(lineitem.l_quantity) > -820) AND (MAX(lineitem.l_quantity) > -821)) AND ((MAX(lineitem.l_quantity) > -822) AND (MAX(lineitem.l_quantity) > -823)))) AND ((((MAX(lineitem.l_quantity) > -824) AND (MAX(lineitem.l_quantity) > -825)) AND ((MAX(lineitem.l_quantity) > -826) AND (MAX(lineitem.l_quantity) > -827))) AND (((MAX(lineitem.l_quantity) > -828) AND (MAX(lineitem.l_quantity) > -829)) AND ((MAX(lineitem.l_quantity) > -830) AND (MAX(lineitem.l_quantity) > -831))))))) AND (((((((MAX(lineitem.l_quantity) > -832) AND (MAX(lineitem.l_quantity) > -833)) AND ((MAX(lineitem.l_quantity) > -834) AND (MAX(lineitem.l_quantity) > -835))) AND (((MAX(lineitem.l_quantity) > -836) AND (MAX(lineitem.l_quantity) > -837)) AND ((MAX(lineitem.l_quantity) > -838) AND (MAX(lineitem.l_quantity) > -839)))) AND ((((MAX(lineitem.l_quantity) > -840) AND (MAX(lineitem.l_quantity) > -841)) AND ((MAX(lineitem.l_quantity) > -842) AND (MAX(lineitem.l_quantity) > -843))) AND (((MAX(lineitem.l_quantity) > -844) AND (MAX(lineitem.l_quantity) > -845)) AND ((MAX(lineitem.l_quantity) > -846) AND (MAX(lineitem.l_quantity) > -847))))) AND (((((MAX(lineitem.l_quantity) > -848) AND (MAX(lineitem.l_quantity) > -849)) AND ((MAX(lineitem.l_quantity) > -850) AND (MAX(lineitem.l_quantity) > -851))) AND (((MAX(lineitem.l_quantity) > -852) AND (MAX(lineitem.l_quantity) > -853)) AND ((MAX(lineitem.l_quantity) > -854) AND (MAX(lineitem.l_quantity) > -855)))) AND ((((MAX(lineitem.l_quantity) > -856) AND (MAX(lineitem.l_quantity) > -857)) AND ((MAX(lineitem.l_quantity) > -858) AND (MAX(lineitem.l_quantity) > -859))) AND (((MAX(lineitem.l_quantity) > -860) AND (MAX(lineitem.l_quantity) > -861)) AND ((MAX(lineitem.l_quantity) > -862) AND (MAX(lineitem.l_quantity) > -863)))))) AND ((((((MAX(lineitem.l_quantity) > -864) AND (MAX(lineitem.l_quantity) > -865)) AND ((MAX(lineitem.l_quantity) > -866) AND (MAX(lineitem.l_quantity) > -867))) AND (((MAX(lineitem.l_quantity) > -868) AND (MAX(lineitem.l_quantity) > -869)) AND ((MAX(lineitem.l_quantity) > -870) AND (MAX(lineitem.l_quantity) > -871)))) AND ((((MAX(lineitem.l_quantity) > -872) AND (MAX(lineitem.l_quantity) > -873)) AND ((MAX(lineitem.l_quantity) > -874) AND (MAX(lineitem.l_quantity) > -875))) AND (((MAX(lineitem.l_quantity) > -876) AND (MAX(lineitem.l_quantity) > -877)) AND ((MAX(lineitem.l_quantity) > -878) AND (MAX(lineitem.l_quantity) > -879))))) AND (((((MAX(lineitem.l_quantity) > -880) AND (MAX(lineitem.l_quantity) > -881)) AND ((MAX(lineitem.l_quantity) > -882) AND (MAX(lineitem.l_quantity) > -883))) AND (((MAX(lineitem.l_quantity) > -884) AND (MAX(lineitem.l_quantity) > -885)) AND ((MAX(lineitem.l_quantity) > -886) AND (MAX(lineitem.l_quantity) > -887)))) AND ((((MAX(lineitem.l_quantity) > -888) AND (MAX(lineitem.l_quantity) > -889)) AND ((MAX(lineitem.l_quantity) > -890) AND (MAX(lineitem.l_quantity) > -891))) AND (((MAX(lineitem.l_quantity) > -892) AND (MAX(lineitem.l_quantity) > -893)) AND ((MAX(lineitem.l_quantity) > -894) AND (MAX(lineitem.l_quantity) > -895)))))))) AND ((((((((MAX(lineitem.l_quantity) > -896) AND (MAX(lineitem.l_quantity) > -897)) AND ((MAX(lineitem.l_quantity) > -898) AND (MAX(lineitem.l_quantity) > -899))) AND (((MAX(lineitem.l_quantity) > -900) AND (MAX(lineitem.l_quantity) > -901)) AND ((MAX(lineitem.l_quantity) > -902) AND (MAX(lineitem.l_quantity) > -903)))) AND ((((MAX(lineitem.l_quantity) > -904) AND (MAX(lineitem.l_quantity) > -905)) AND ((MAX(lineitem.l_quantity) > -906) AND (MAX(lineitem.l_quantity) > -907))) AND (((MAX(lineitem.l_quantity) > -908) AND (MAX(lineitem.l_quantity) > -909)) AND ((MAX(lineitem.l_quantity) > -910) AND (MAX(lineitem.l_quantity) > -911))))) AND (((((MAX(lineitem.l_quantity) > -912) AND (MAX(lineitem.l_quantity) > -913)) AND ((MAX(lineitem.l_quantity) > -914) AND (MAX(lineitem.l_quantity) > -915))) AND (((MAX(lineitem.l_quantity) > -916) AND (MAX(lineitem.l_quantity) > -917)) AND ((MAX(lineitem.l_quantity) > -918) AND (MAX(lineitem.l_quantity) > -919)))) AND ((((MAX(lineitem.l_quantity) > -920) AND (MAX(lineitem.l_quantity) > -921)) AND ((MAX(lineitem.l_quantity) > -922) AND (MAX(lineitem.l_quantity) > -923))) AND (((MAX(lineitem.l_quantity) > -924) AND (MAX(lineitem.l_quantity) > -925)) AND ((MAX(lineitem.l_quantity) > -926) AND (MAX(lineitem.l_quantity) > -927)))))) AND ((((((MAX(lineitem.l_quantity) > -928) AND (MAX(lineitem.l_quantity) > -929)) AND ((MAX(lineitem.l_quantity) > -930) AND (MAX(lineitem.l_quantity) > -931))) AND (((MAX(lineitem.l_quantity) > -932) AND (MAX(lineitem.l_quantity) > -933)) AND ((MAX(lineitem.l_quantity) > -934) AND (MAX(lineitem.l_quantity) > -935)))) AND ((((MAX(lineitem.l_quantity) > -936) AND (MAX(lineitem.l_quantity) > -937)) AND ((MAX(lineitem.l_quantity) > -938) AND (MAX(lineitem.l_quantity) > -939))) AND (((MAX(lineitem.l_quantity) > -940) AND (MAX(lineitem.l_quantity) > -941)) AND ((MAX(lineitem.l_quantity) > -942) AND (MAX(lineitem.l_quantity) > -943))))) AND (((((MAX(lineitem.l_quantity) > -944) AND (MAX(lineitem.l_quantity) > -945)) AND ((MAX(lineitem.l_quantity) > -946) AND (MAX(lineitem.l_quantity) > -947))) AND (((MAX(lineitem.l_quantity) > -948) AND (MAX(lineitem.l_quantity) > -949)) AND ((MAX(lineitem.l_quantity) > -950) AND (MAX(lineitem.l_quantity) > -951)))) AND ((((MAX(lineitem.l_quantity) > -952) AND (MAX(lineitem.l_quantity) > -953)) AND ((MAX(lineitem.l_quantity) > -954) AND (MAX(lineitem.l_quantity) > -955))) AND (((MAX(lineitem.l_quantity) > -956) AND (MAX(lineitem.l_quantity) > -957)) AND ((MAX(lineitem.l_quantity) > -958) AND (MAX(lineitem.l_quantity) > -959))))))) AND (((((((MAX(lineitem.l_quantity) > -960) AND (MAX(lineitem.l_quantity) > -961)) AND ((MAX(lineitem.l_quantity) > -962) AND (MAX(lineitem.l_quantity) > -963))) AND (((MAX(lineitem.l_quantity) > -964) AND (MAX(lineitem.l_quantity) > -965)) AND ((MAX(lineitem.l_quantity) > -966) AND (MAX(lineitem.l_quantity) > -967)))) AND ((((MAX(lineitem.l_quantity) > -968) AND (MAX(lineitem.l_quantity) > -969)) AND ((MAX(lineitem.l_quantity) > -970) AND (MAX(lineitem.l_quantity) > -971))) AND (((MAX(lineitem.l_quantity) > -972) AND (MAX(lineitem.l_quantity) > -973)) AND ((MAX(lineitem.l_quantity) > -974) AND (MAX(lineitem.l_quantity) > -975))))) AND (((((MAX(lineitem.l_quantity) > -976) AND (MAX(lineitem.l_quantity) > -977)) AND ((MAX(lineitem.l_quantity) > -978) AND (MAX(lineitem.l_quantity) > -979))) AND (((MAX(lineitem.l_quantity) > -980) AND (MAX(lineitem.l_quantity) > -981)) AND ((MAX(lineitem.l_quantity) > -982) AND (MAX(lineitem.l_quantity) > -983)))) AND ((((MAX(lineitem.l_quantity) > -984) AND (MAX(lineitem.l_quantity) > -985)) AND ((MAX(lineitem.l_quantity) > -986) AND (MAX(lineitem.l_quantity) > -987))) AND (((MAX(lineitem.l_quantity) > -988) AND (MAX(lineitem.l_quantity) > -989)) AND ((MAX(lineitem.l_quantity) > -990) AND (MAX(lineitem.l_quantity) > -991)))))) AND ((((MAX(lineitem.l_quantity) > -992) AND (MAX(lineitem.l_quantity) > -993)) AND ((MAX(lineitem.l_quantity) > -994) AND (MAX(lineitem.l_quantity) > -995))) AND (((MAX(lineitem.l_quantity) > -996) AND (MAX(lineitem.l_quantity) > -997)) AND ((MAX(lineitem.l_quantity) > -998) AND (MAX(lineitem.l_quantity) > -999))))))))) ORDER BY base_query.l_returnflag, base_query.l_linestatus""",
}


def _normalize_sql(sql: str) -> str:
    safe_sql = sql.replace("{temp_table_name}", "temp_table_name")
    safe_sql = re.sub(r"query_results_[a-f0-9]{8}", "temp_table_name", safe_sql)
    return sqlglot.parse_one(safe_sql, read="duckdb").sql(dialect="duckdb")


def _assert_sql_equal(expected: str, actual: str, label: str) -> None:
    expected_normalized = _normalize_sql(expected)
    actual_normalized = _normalize_sql(actual)
    assert expected_normalized == actual_normalized, (
        f"{label} SQL does not match expected.\n"
        f"Expected SQL:\n{expected}\n\n"
        f"Actual SQL:\n{actual}"
    )


PHYSICAL_EXPECTED_SQL_Q01 = {
    1: """WITH lineage AS (
SELECT
    lineage.out_index
FROM (
SELECT "output_id" AS out_index, "opid_8_lineitem" AS "lineitem" FROM read_block(0)
) AS lineage
JOIN lineitem
    ON lineitem.rowid::bigint = lineage.lineitem::bigint
GROUP BY lineage.out_index
HAVING MAX(lineitem.l_quantity) > 0
)
SELECT
    generated_table."l_returnflag", generated_table."l_linestatus", generated_table."sum_qty", generated_table."sum_base_price", generated_table."sum_disc_price", generated_table."sum_charge", generated_table."avg_qty", generated_table."avg_price", generated_table."avg_disc", generated_table."count_order"
FROM {temp_table_name} AS generated_table
JOIN lineage
    ON generated_table.rowid::bigint = lineage.out_index::bigint
ORDER BY generated_table.l_returnflag, generated_table.l_linestatus""",
    10: """WITH lineage AS (
SELECT
    lineage.out_index
FROM (
SELECT "output_id" AS out_index, "opid_8_lineitem" AS "lineitem" FROM read_block(0)
) AS lineage
JOIN lineitem
    ON lineitem.rowid::bigint = lineage.lineitem::bigint
GROUP BY lineage.out_index
HAVING (MAX(lineitem.l_quantity) > 0) AND (MAX(lineitem.l_quantity) > -1) AND (MAX(lineitem.l_quantity) > -2) AND (MAX(lineitem.l_quantity) > -3) AND (MAX(lineitem.l_quantity) > -4) AND (MAX(lineitem.l_quantity) > -5) AND (MAX(lineitem.l_quantity) > -6) AND (MAX(lineitem.l_quantity) > -7) AND (MAX(lineitem.l_quantity) > -8) AND (MAX(lineitem.l_quantity) > -9)
)
SELECT
    generated_table."l_returnflag", generated_table."l_linestatus", generated_table."sum_qty", generated_table."sum_base_price", generated_table."sum_disc_price", generated_table."sum_charge", generated_table."avg_qty", generated_table."avg_price", generated_table."avg_disc", generated_table."count_order"
FROM {temp_table_name} AS generated_table
JOIN lineage
    ON generated_table.rowid::bigint = lineage.out_index::bigint
ORDER BY generated_table.l_returnflag, generated_table.l_linestatus""",
    100: """WITH lineage AS (
SELECT
    lineage.out_index
FROM (
SELECT "output_id" AS out_index, "opid_8_lineitem" AS "lineitem" FROM read_block(0)
) AS lineage
JOIN lineitem
    ON lineitem.rowid::bigint = lineage.lineitem::bigint
GROUP BY lineage.out_index
HAVING (MAX(lineitem.l_quantity) > 0) AND (MAX(lineitem.l_quantity) > -1) AND (MAX(lineitem.l_quantity) > -2) AND (MAX(lineitem.l_quantity) > -3) AND (MAX(lineitem.l_quantity) > -4) AND (MAX(lineitem.l_quantity) > -5) AND (MAX(lineitem.l_quantity) > -6) AND (MAX(lineitem.l_quantity) > -7) AND (MAX(lineitem.l_quantity) > -8) AND (MAX(lineitem.l_quantity) > -9) AND (MAX(lineitem.l_quantity) > -10) AND (MAX(lineitem.l_quantity) > -11) AND (MAX(lineitem.l_quantity) > -12) AND (MAX(lineitem.l_quantity) > -13) AND (MAX(lineitem.l_quantity) > -14) AND (MAX(lineitem.l_quantity) > -15) AND (MAX(lineitem.l_quantity) > -16) AND (MAX(lineitem.l_quantity) > -17) AND (MAX(lineitem.l_quantity) > -18) AND (MAX(lineitem.l_quantity) > -19) AND (MAX(lineitem.l_quantity) > -20) AND (MAX(lineitem.l_quantity) > -21) AND (MAX(lineitem.l_quantity) > -22) AND (MAX(lineitem.l_quantity) > -23) AND (MAX(lineitem.l_quantity) > -24) AND (MAX(lineitem.l_quantity) > -25) AND (MAX(lineitem.l_quantity) > -26) AND (MAX(lineitem.l_quantity) > -27) AND (MAX(lineitem.l_quantity) > -28) AND (MAX(lineitem.l_quantity) > -29) AND (MAX(lineitem.l_quantity) > -30) AND (MAX(lineitem.l_quantity) > -31) AND (MAX(lineitem.l_quantity) > -32) AND (MAX(lineitem.l_quantity) > -33) AND (MAX(lineitem.l_quantity) > -34) AND (MAX(lineitem.l_quantity) > -35) AND (MAX(lineitem.l_quantity) > -36) AND (MAX(lineitem.l_quantity) > -37) AND (MAX(lineitem.l_quantity) > -38) AND (MAX(lineitem.l_quantity) > -39) AND (MAX(lineitem.l_quantity) > -40) AND (MAX(lineitem.l_quantity) > -41) AND (MAX(lineitem.l_quantity) > -42) AND (MAX(lineitem.l_quantity) > -43) AND (MAX(lineitem.l_quantity) > -44) AND (MAX(lineitem.l_quantity) > -45) AND (MAX(lineitem.l_quantity) > -46) AND (MAX(lineitem.l_quantity) > -47) AND (MAX(lineitem.l_quantity) > -48) AND (MAX(lineitem.l_quantity) > -49) AND (MAX(lineitem.l_quantity) > -50) AND (MAX(lineitem.l_quantity) > -51) AND (MAX(lineitem.l_quantity) > -52) AND (MAX(lineitem.l_quantity) > -53) AND (MAX(lineitem.l_quantity) > -54) AND (MAX(lineitem.l_quantity) > -55) AND (MAX(lineitem.l_quantity) > -56) AND (MAX(lineitem.l_quantity) > -57) AND (MAX(lineitem.l_quantity) > -58) AND (MAX(lineitem.l_quantity) > -59) AND (MAX(lineitem.l_quantity) > -60) AND (MAX(lineitem.l_quantity) > -61) AND (MAX(lineitem.l_quantity) > -62) AND (MAX(lineitem.l_quantity) > -63) AND (MAX(lineitem.l_quantity) > -64) AND (MAX(lineitem.l_quantity) > -65) AND (MAX(lineitem.l_quantity) > -66) AND (MAX(lineitem.l_quantity) > -67) AND (MAX(lineitem.l_quantity) > -68) AND (MAX(lineitem.l_quantity) > -69) AND (MAX(lineitem.l_quantity) > -70) AND (MAX(lineitem.l_quantity) > -71) AND (MAX(lineitem.l_quantity) > -72) AND (MAX(lineitem.l_quantity) > -73) AND (MAX(lineitem.l_quantity) > -74) AND (MAX(lineitem.l_quantity) > -75) AND (MAX(lineitem.l_quantity) > -76) AND (MAX(lineitem.l_quantity) > -77) AND (MAX(lineitem.l_quantity) > -78) AND (MAX(lineitem.l_quantity) > -79) AND (MAX(lineitem.l_quantity) > -80) AND (MAX(lineitem.l_quantity) > -81) AND (MAX(lineitem.l_quantity) > -82) AND (MAX(lineitem.l_quantity) > -83) AND (MAX(lineitem.l_quantity) > -84) AND (MAX(lineitem.l_quantity) > -85) AND (MAX(lineitem.l_quantity) > -86) AND (MAX(lineitem.l_quantity) > -87) AND (MAX(lineitem.l_quantity) > -88) AND (MAX(lineitem.l_quantity) > -89) AND (MAX(lineitem.l_quantity) > -90) AND (MAX(lineitem.l_quantity) > -91) AND (MAX(lineitem.l_quantity) > -92) AND (MAX(lineitem.l_quantity) > -93) AND (MAX(lineitem.l_quantity) > -94) AND (MAX(lineitem.l_quantity) > -95) AND (MAX(lineitem.l_quantity) > -96) AND (MAX(lineitem.l_quantity) > -97) AND (MAX(lineitem.l_quantity) > -98) AND (MAX(lineitem.l_quantity) > -99)
)
SELECT
    generated_table."l_returnflag", generated_table."l_linestatus", generated_table."sum_qty", generated_table."sum_base_price", generated_table."sum_disc_price", generated_table."sum_charge", generated_table."avg_qty", generated_table."avg_price", generated_table."avg_disc", generated_table."count_order"
FROM {temp_table_name} AS generated_table
JOIN lineage
    ON generated_table.rowid::bigint = lineage.out_index::bigint
ORDER BY generated_table.l_returnflag, generated_table.l_linestatus""",
    1000: """WITH lineage AS (
SELECT
    lineage.out_index
FROM (
SELECT "output_id" AS out_index, "opid_8_lineitem" AS "lineitem" FROM read_block(0)
) AS lineage
JOIN lineitem
    ON lineitem.rowid::bigint = lineage.lineitem::bigint
GROUP BY lineage.out_index
HAVING (MAX(lineitem.l_quantity) > 0) AND (MAX(lineitem.l_quantity) > -1) AND (MAX(lineitem.l_quantity) > -2) AND (MAX(lineitem.l_quantity) > -3) AND (MAX(lineitem.l_quantity) > -4) AND (MAX(lineitem.l_quantity) > -5) AND (MAX(lineitem.l_quantity) > -6) AND (MAX(lineitem.l_quantity) > -7) AND (MAX(lineitem.l_quantity) > -8) AND (MAX(lineitem.l_quantity) > -9) AND (MAX(lineitem.l_quantity) > -10) AND (MAX(lineitem.l_quantity) > -11) AND (MAX(lineitem.l_quantity) > -12) AND (MAX(lineitem.l_quantity) > -13) AND (MAX(lineitem.l_quantity) > -14) AND (MAX(lineitem.l_quantity) > -15) AND (MAX(lineitem.l_quantity) > -16) AND (MAX(lineitem.l_quantity) > -17) AND (MAX(lineitem.l_quantity) > -18) AND (MAX(lineitem.l_quantity) > -19) AND (MAX(lineitem.l_quantity) > -20) AND (MAX(lineitem.l_quantity) > -21) AND (MAX(lineitem.l_quantity) > -22) AND (MAX(lineitem.l_quantity) > -23) AND (MAX(lineitem.l_quantity) > -24) AND (MAX(lineitem.l_quantity) > -25) AND (MAX(lineitem.l_quantity) > -26) AND (MAX(lineitem.l_quantity) > -27) AND (MAX(lineitem.l_quantity) > -28) AND (MAX(lineitem.l_quantity) > -29) AND (MAX(lineitem.l_quantity) > -30) AND (MAX(lineitem.l_quantity) > -31) AND (MAX(lineitem.l_quantity) > -32) AND (MAX(lineitem.l_quantity) > -33) AND (MAX(lineitem.l_quantity) > -34) AND (MAX(lineitem.l_quantity) > -35) AND (MAX(lineitem.l_quantity) > -36) AND (MAX(lineitem.l_quantity) > -37) AND (MAX(lineitem.l_quantity) > -38) AND (MAX(lineitem.l_quantity) > -39) AND (MAX(lineitem.l_quantity) > -40) AND (MAX(lineitem.l_quantity) > -41) AND (MAX(lineitem.l_quantity) > -42) AND (MAX(lineitem.l_quantity) > -43) AND (MAX(lineitem.l_quantity) > -44) AND (MAX(lineitem.l_quantity) > -45) AND (MAX(lineitem.l_quantity) > -46) AND (MAX(lineitem.l_quantity) > -47) AND (MAX(lineitem.l_quantity) > -48) AND (MAX(lineitem.l_quantity) > -49) AND (MAX(lineitem.l_quantity) > -50) AND (MAX(lineitem.l_quantity) > -51) AND (MAX(lineitem.l_quantity) > -52) AND (MAX(lineitem.l_quantity) > -53) AND (MAX(lineitem.l_quantity) > -54) AND (MAX(lineitem.l_quantity) > -55) AND (MAX(lineitem.l_quantity) > -56) AND (MAX(lineitem.l_quantity) > -57) AND (MAX(lineitem.l_quantity) > -58) AND (MAX(lineitem.l_quantity) > -59) AND (MAX(lineitem.l_quantity) > -60) AND (MAX(lineitem.l_quantity) > -61) AND (MAX(lineitem.l_quantity) > -62) AND (MAX(lineitem.l_quantity) > -63) AND (MAX(lineitem.l_quantity) > -64) AND (MAX(lineitem.l_quantity) > -65) AND (MAX(lineitem.l_quantity) > -66) AND (MAX(lineitem.l_quantity) > -67) AND (MAX(lineitem.l_quantity) > -68) AND (MAX(lineitem.l_quantity) > -69) AND (MAX(lineitem.l_quantity) > -70) AND (MAX(lineitem.l_quantity) > -71) AND (MAX(lineitem.l_quantity) > -72) AND (MAX(lineitem.l_quantity) > -73) AND (MAX(lineitem.l_quantity) > -74) AND (MAX(lineitem.l_quantity) > -75) AND (MAX(lineitem.l_quantity) > -76) AND (MAX(lineitem.l_quantity) > -77) AND (MAX(lineitem.l_quantity) > -78) AND (MAX(lineitem.l_quantity) > -79) AND (MAX(lineitem.l_quantity) > -80) AND (MAX(lineitem.l_quantity) > -81) AND (MAX(lineitem.l_quantity) > -82) AND (MAX(lineitem.l_quantity) > -83) AND (MAX(lineitem.l_quantity) > -84) AND (MAX(lineitem.l_quantity) > -85) AND (MAX(lineitem.l_quantity) > -86) AND (MAX(lineitem.l_quantity) > -87) AND (MAX(lineitem.l_quantity) > -88) AND (MAX(lineitem.l_quantity) > -89) AND (MAX(lineitem.l_quantity) > -90) AND (MAX(lineitem.l_quantity) > -91) AND (MAX(lineitem.l_quantity) > -92) AND (MAX(lineitem.l_quantity) > -93) AND (MAX(lineitem.l_quantity) > -94) AND (MAX(lineitem.l_quantity) > -95) AND (MAX(lineitem.l_quantity) > -96) AND (MAX(lineitem.l_quantity) > -97) AND (MAX(lineitem.l_quantity) > -98) AND (MAX(lineitem.l_quantity) > -99) AND (MAX(lineitem.l_quantity) > -100) AND (MAX(lineitem.l_quantity) > -101) AND (MAX(lineitem.l_quantity) > -102) AND (MAX(lineitem.l_quantity) > -103) AND (MAX(lineitem.l_quantity) > -104) AND (MAX(lineitem.l_quantity) > -105) AND (MAX(lineitem.l_quantity) > -106) AND (MAX(lineitem.l_quantity) > -107) AND (MAX(lineitem.l_quantity) > -108) AND (MAX(lineitem.l_quantity) > -109) AND (MAX(lineitem.l_quantity) > -110) AND (MAX(lineitem.l_quantity) > -111) AND (MAX(lineitem.l_quantity) > -112) AND (MAX(lineitem.l_quantity) > -113) AND (MAX(lineitem.l_quantity) > -114) AND (MAX(lineitem.l_quantity) > -115) AND (MAX(lineitem.l_quantity) > -116) AND (MAX(lineitem.l_quantity) > -117) AND (MAX(lineitem.l_quantity) > -118) AND (MAX(lineitem.l_quantity) > -119) AND (MAX(lineitem.l_quantity) > -120) AND (MAX(lineitem.l_quantity) > -121) AND (MAX(lineitem.l_quantity) > -122) AND (MAX(lineitem.l_quantity) > -123) AND (MAX(lineitem.l_quantity) > -124) AND (MAX(lineitem.l_quantity) > -125) AND (MAX(lineitem.l_quantity) > -126) AND (MAX(lineitem.l_quantity) > -127) AND (MAX(lineitem.l_quantity) > -128) AND (MAX(lineitem.l_quantity) > -129) AND (MAX(lineitem.l_quantity) > -130) AND (MAX(lineitem.l_quantity) > -131) AND (MAX(lineitem.l_quantity) > -132) AND (MAX(lineitem.l_quantity) > -133) AND (MAX(lineitem.l_quantity) > -134) AND (MAX(lineitem.l_quantity) > -135) AND (MAX(lineitem.l_quantity) > -136) AND (MAX(lineitem.l_quantity) > -137) AND (MAX(lineitem.l_quantity) > -138) AND (MAX(lineitem.l_quantity) > -139) AND (MAX(lineitem.l_quantity) > -140) AND (MAX(lineitem.l_quantity) > -141) AND (MAX(lineitem.l_quantity) > -142) AND (MAX(lineitem.l_quantity) > -143) AND (MAX(lineitem.l_quantity) > -144) AND (MAX(lineitem.l_quantity) > -145) AND (MAX(lineitem.l_quantity) > -146) AND (MAX(lineitem.l_quantity) > -147) AND (MAX(lineitem.l_quantity) > -148) AND (MAX(lineitem.l_quantity) > -149) AND (MAX(lineitem.l_quantity) > -150) AND (MAX(lineitem.l_quantity) > -151) AND (MAX(lineitem.l_quantity) > -152) AND (MAX(lineitem.l_quantity) > -153) AND (MAX(lineitem.l_quantity) > -154) AND (MAX(lineitem.l_quantity) > -155) AND (MAX(lineitem.l_quantity) > -156) AND (MAX(lineitem.l_quantity) > -157) AND (MAX(lineitem.l_quantity) > -158) AND (MAX(lineitem.l_quantity) > -159) AND (MAX(lineitem.l_quantity) > -160) AND (MAX(lineitem.l_quantity) > -161) AND (MAX(lineitem.l_quantity) > -162) AND (MAX(lineitem.l_quantity) > -163) AND (MAX(lineitem.l_quantity) > -164) AND (MAX(lineitem.l_quantity) > -165) AND (MAX(lineitem.l_quantity) > -166) AND (MAX(lineitem.l_quantity) > -167) AND (MAX(lineitem.l_quantity) > -168) AND (MAX(lineitem.l_quantity) > -169) AND (MAX(lineitem.l_quantity) > -170) AND (MAX(lineitem.l_quantity) > -171) AND (MAX(lineitem.l_quantity) > -172) AND (MAX(lineitem.l_quantity) > -173) AND (MAX(lineitem.l_quantity) > -174) AND (MAX(lineitem.l_quantity) > -175) AND (MAX(lineitem.l_quantity) > -176) AND (MAX(lineitem.l_quantity) > -177) AND (MAX(lineitem.l_quantity) > -178) AND (MAX(lineitem.l_quantity) > -179) AND (MAX(lineitem.l_quantity) > -180) AND (MAX(lineitem.l_quantity) > -181) AND (MAX(lineitem.l_quantity) > -182) AND (MAX(lineitem.l_quantity) > -183) AND (MAX(lineitem.l_quantity) > -184) AND (MAX(lineitem.l_quantity) > -185) AND (MAX(lineitem.l_quantity) > -186) AND (MAX(lineitem.l_quantity) > -187) AND (MAX(lineitem.l_quantity) > -188) AND (MAX(lineitem.l_quantity) > -189) AND (MAX(lineitem.l_quantity) > -190) AND (MAX(lineitem.l_quantity) > -191) AND (MAX(lineitem.l_quantity) > -192) AND (MAX(lineitem.l_quantity) > -193) AND (MAX(lineitem.l_quantity) > -194) AND (MAX(lineitem.l_quantity) > -195) AND (MAX(lineitem.l_quantity) > -196) AND (MAX(lineitem.l_quantity) > -197) AND (MAX(lineitem.l_quantity) > -198) AND (MAX(lineitem.l_quantity) > -199) AND (MAX(lineitem.l_quantity) > -200) AND (MAX(lineitem.l_quantity) > -201) AND (MAX(lineitem.l_quantity) > -202) AND (MAX(lineitem.l_quantity) > -203) AND (MAX(lineitem.l_quantity) > -204) AND (MAX(lineitem.l_quantity) > -205) AND (MAX(lineitem.l_quantity) > -206) AND (MAX(lineitem.l_quantity) > -207) AND (MAX(lineitem.l_quantity) > -208) AND (MAX(lineitem.l_quantity) > -209) AND (MAX(lineitem.l_quantity) > -210) AND (MAX(lineitem.l_quantity) > -211) AND (MAX(lineitem.l_quantity) > -212) AND (MAX(lineitem.l_quantity) > -213) AND (MAX(lineitem.l_quantity) > -214) AND (MAX(lineitem.l_quantity) > -215) AND (MAX(lineitem.l_quantity) > -216) AND (MAX(lineitem.l_quantity) > -217) AND (MAX(lineitem.l_quantity) > -218) AND (MAX(lineitem.l_quantity) > -219) AND (MAX(lineitem.l_quantity) > -220) AND (MAX(lineitem.l_quantity) > -221) AND (MAX(lineitem.l_quantity) > -222) AND (MAX(lineitem.l_quantity) > -223) AND (MAX(lineitem.l_quantity) > -224) AND (MAX(lineitem.l_quantity) > -225) AND (MAX(lineitem.l_quantity) > -226) AND (MAX(lineitem.l_quantity) > -227) AND (MAX(lineitem.l_quantity) > -228) AND (MAX(lineitem.l_quantity) > -229) AND (MAX(lineitem.l_quantity) > -230) AND (MAX(lineitem.l_quantity) > -231) AND (MAX(lineitem.l_quantity) > -232) AND (MAX(lineitem.l_quantity) > -233) AND (MAX(lineitem.l_quantity) > -234) AND (MAX(lineitem.l_quantity) > -235) AND (MAX(lineitem.l_quantity) > -236) AND (MAX(lineitem.l_quantity) > -237) AND (MAX(lineitem.l_quantity) > -238) AND (MAX(lineitem.l_quantity) > -239) AND (MAX(lineitem.l_quantity) > -240) AND (MAX(lineitem.l_quantity) > -241) AND (MAX(lineitem.l_quantity) > -242) AND (MAX(lineitem.l_quantity) > -243) AND (MAX(lineitem.l_quantity) > -244) AND (MAX(lineitem.l_quantity) > -245) AND (MAX(lineitem.l_quantity) > -246) AND (MAX(lineitem.l_quantity) > -247) AND (MAX(lineitem.l_quantity) > -248) AND (MAX(lineitem.l_quantity) > -249) AND (MAX(lineitem.l_quantity) > -250) AND (MAX(lineitem.l_quantity) > -251) AND (MAX(lineitem.l_quantity) > -252) AND (MAX(lineitem.l_quantity) > -253) AND (MAX(lineitem.l_quantity) > -254) AND (MAX(lineitem.l_quantity) > -255) AND (MAX(lineitem.l_quantity) > -256) AND (MAX(lineitem.l_quantity) > -257) AND (MAX(lineitem.l_quantity) > -258) AND (MAX(lineitem.l_quantity) > -259) AND (MAX(lineitem.l_quantity) > -260) AND (MAX(lineitem.l_quantity) > -261) AND (MAX(lineitem.l_quantity) > -262) AND (MAX(lineitem.l_quantity) > -263) AND (MAX(lineitem.l_quantity) > -264) AND (MAX(lineitem.l_quantity) > -265) AND (MAX(lineitem.l_quantity) > -266) AND (MAX(lineitem.l_quantity) > -267) AND (MAX(lineitem.l_quantity) > -268) AND (MAX(lineitem.l_quantity) > -269) AND (MAX(lineitem.l_quantity) > -270) AND (MAX(lineitem.l_quantity) > -271) AND (MAX(lineitem.l_quantity) > -272) AND (MAX(lineitem.l_quantity) > -273) AND (MAX(lineitem.l_quantity) > -274) AND (MAX(lineitem.l_quantity) > -275) AND (MAX(lineitem.l_quantity) > -276) AND (MAX(lineitem.l_quantity) > -277) AND (MAX(lineitem.l_quantity) > -278) AND (MAX(lineitem.l_quantity) > -279) AND (MAX(lineitem.l_quantity) > -280) AND (MAX(lineitem.l_quantity) > -281) AND (MAX(lineitem.l_quantity) > -282) AND (MAX(lineitem.l_quantity) > -283) AND (MAX(lineitem.l_quantity) > -284) AND (MAX(lineitem.l_quantity) > -285) AND (MAX(lineitem.l_quantity) > -286) AND (MAX(lineitem.l_quantity) > -287) AND (MAX(lineitem.l_quantity) > -288) AND (MAX(lineitem.l_quantity) > -289) AND (MAX(lineitem.l_quantity) > -290) AND (MAX(lineitem.l_quantity) > -291) AND (MAX(lineitem.l_quantity) > -292) AND (MAX(lineitem.l_quantity) > -293) AND (MAX(lineitem.l_quantity) > -294) AND (MAX(lineitem.l_quantity) > -295) AND (MAX(lineitem.l_quantity) > -296) AND (MAX(lineitem.l_quantity) > -297) AND (MAX(lineitem.l_quantity) > -298) AND (MAX(lineitem.l_quantity) > -299) AND (MAX(lineitem.l_quantity) > -300) AND (MAX(lineitem.l_quantity) > -301) AND (MAX(lineitem.l_quantity) > -302) AND (MAX(lineitem.l_quantity) > -303) AND (MAX(lineitem.l_quantity) > -304) AND (MAX(lineitem.l_quantity) > -305) AND (MAX(lineitem.l_quantity) > -306) AND (MAX(lineitem.l_quantity) > -307) AND (MAX(lineitem.l_quantity) > -308) AND (MAX(lineitem.l_quantity) > -309) AND (MAX(lineitem.l_quantity) > -310) AND (MAX(lineitem.l_quantity) > -311) AND (MAX(lineitem.l_quantity) > -312) AND (MAX(lineitem.l_quantity) > -313) AND (MAX(lineitem.l_quantity) > -314) AND (MAX(lineitem.l_quantity) > -315) AND (MAX(lineitem.l_quantity) > -316) AND (MAX(lineitem.l_quantity) > -317) AND (MAX(lineitem.l_quantity) > -318) AND (MAX(lineitem.l_quantity) > -319) AND (MAX(lineitem.l_quantity) > -320) AND (MAX(lineitem.l_quantity) > -321) AND (MAX(lineitem.l_quantity) > -322) AND (MAX(lineitem.l_quantity) > -323) AND (MAX(lineitem.l_quantity) > -324) AND (MAX(lineitem.l_quantity) > -325) AND (MAX(lineitem.l_quantity) > -326) AND (MAX(lineitem.l_quantity) > -327) AND (MAX(lineitem.l_quantity) > -328) AND (MAX(lineitem.l_quantity) > -329) AND (MAX(lineitem.l_quantity) > -330) AND (MAX(lineitem.l_quantity) > -331) AND (MAX(lineitem.l_quantity) > -332) AND (MAX(lineitem.l_quantity) > -333) AND (MAX(lineitem.l_quantity) > -334) AND (MAX(lineitem.l_quantity) > -335) AND (MAX(lineitem.l_quantity) > -336) AND (MAX(lineitem.l_quantity) > -337) AND (MAX(lineitem.l_quantity) > -338) AND (MAX(lineitem.l_quantity) > -339) AND (MAX(lineitem.l_quantity) > -340) AND (MAX(lineitem.l_quantity) > -341) AND (MAX(lineitem.l_quantity) > -342) AND (MAX(lineitem.l_quantity) > -343) AND (MAX(lineitem.l_quantity) > -344) AND (MAX(lineitem.l_quantity) > -345) AND (MAX(lineitem.l_quantity) > -346) AND (MAX(lineitem.l_quantity) > -347) AND (MAX(lineitem.l_quantity) > -348) AND (MAX(lineitem.l_quantity) > -349) AND (MAX(lineitem.l_quantity) > -350) AND (MAX(lineitem.l_quantity) > -351) AND (MAX(lineitem.l_quantity) > -352) AND (MAX(lineitem.l_quantity) > -353) AND (MAX(lineitem.l_quantity) > -354) AND (MAX(lineitem.l_quantity) > -355) AND (MAX(lineitem.l_quantity) > -356) AND (MAX(lineitem.l_quantity) > -357) AND (MAX(lineitem.l_quantity) > -358) AND (MAX(lineitem.l_quantity) > -359) AND (MAX(lineitem.l_quantity) > -360) AND (MAX(lineitem.l_quantity) > -361) AND (MAX(lineitem.l_quantity) > -362) AND (MAX(lineitem.l_quantity) > -363) AND (MAX(lineitem.l_quantity) > -364) AND (MAX(lineitem.l_quantity) > -365) AND (MAX(lineitem.l_quantity) > -366) AND (MAX(lineitem.l_quantity) > -367) AND (MAX(lineitem.l_quantity) > -368) AND (MAX(lineitem.l_quantity) > -369) AND (MAX(lineitem.l_quantity) > -370) AND (MAX(lineitem.l_quantity) > -371) AND (MAX(lineitem.l_quantity) > -372) AND (MAX(lineitem.l_quantity) > -373) AND (MAX(lineitem.l_quantity) > -374) AND (MAX(lineitem.l_quantity) > -375) AND (MAX(lineitem.l_quantity) > -376) AND (MAX(lineitem.l_quantity) > -377) AND (MAX(lineitem.l_quantity) > -378) AND (MAX(lineitem.l_quantity) > -379) AND (MAX(lineitem.l_quantity) > -380) AND (MAX(lineitem.l_quantity) > -381) AND (MAX(lineitem.l_quantity) > -382) AND (MAX(lineitem.l_quantity) > -383) AND (MAX(lineitem.l_quantity) > -384) AND (MAX(lineitem.l_quantity) > -385) AND (MAX(lineitem.l_quantity) > -386) AND (MAX(lineitem.l_quantity) > -387) AND (MAX(lineitem.l_quantity) > -388) AND (MAX(lineitem.l_quantity) > -389) AND (MAX(lineitem.l_quantity) > -390) AND (MAX(lineitem.l_quantity) > -391) AND (MAX(lineitem.l_quantity) > -392) AND (MAX(lineitem.l_quantity) > -393) AND (MAX(lineitem.l_quantity) > -394) AND (MAX(lineitem.l_quantity) > -395) AND (MAX(lineitem.l_quantity) > -396) AND (MAX(lineitem.l_quantity) > -397) AND (MAX(lineitem.l_quantity) > -398) AND (MAX(lineitem.l_quantity) > -399) AND (MAX(lineitem.l_quantity) > -400) AND (MAX(lineitem.l_quantity) > -401) AND (MAX(lineitem.l_quantity) > -402) AND (MAX(lineitem.l_quantity) > -403) AND (MAX(lineitem.l_quantity) > -404) AND (MAX(lineitem.l_quantity) > -405) AND (MAX(lineitem.l_quantity) > -406) AND (MAX(lineitem.l_quantity) > -407) AND (MAX(lineitem.l_quantity) > -408) AND (MAX(lineitem.l_quantity) > -409) AND (MAX(lineitem.l_quantity) > -410) AND (MAX(lineitem.l_quantity) > -411) AND (MAX(lineitem.l_quantity) > -412) AND (MAX(lineitem.l_quantity) > -413) AND (MAX(lineitem.l_quantity) > -414) AND (MAX(lineitem.l_quantity) > -415) AND (MAX(lineitem.l_quantity) > -416) AND (MAX(lineitem.l_quantity) > -417) AND (MAX(lineitem.l_quantity) > -418) AND (MAX(lineitem.l_quantity) > -419) AND (MAX(lineitem.l_quantity) > -420) AND (MAX(lineitem.l_quantity) > -421) AND (MAX(lineitem.l_quantity) > -422) AND (MAX(lineitem.l_quantity) > -423) AND (MAX(lineitem.l_quantity) > -424) AND (MAX(lineitem.l_quantity) > -425) AND (MAX(lineitem.l_quantity) > -426) AND (MAX(lineitem.l_quantity) > -427) AND (MAX(lineitem.l_quantity) > -428) AND (MAX(lineitem.l_quantity) > -429) AND (MAX(lineitem.l_quantity) > -430) AND (MAX(lineitem.l_quantity) > -431) AND (MAX(lineitem.l_quantity) > -432) AND (MAX(lineitem.l_quantity) > -433) AND (MAX(lineitem.l_quantity) > -434) AND (MAX(lineitem.l_quantity) > -435) AND (MAX(lineitem.l_quantity) > -436) AND (MAX(lineitem.l_quantity) > -437) AND (MAX(lineitem.l_quantity) > -438) AND (MAX(lineitem.l_quantity) > -439) AND (MAX(lineitem.l_quantity) > -440) AND (MAX(lineitem.l_quantity) > -441) AND (MAX(lineitem.l_quantity) > -442) AND (MAX(lineitem.l_quantity) > -443) AND (MAX(lineitem.l_quantity) > -444) AND (MAX(lineitem.l_quantity) > -445) AND (MAX(lineitem.l_quantity) > -446) AND (MAX(lineitem.l_quantity) > -447) AND (MAX(lineitem.l_quantity) > -448) AND (MAX(lineitem.l_quantity) > -449) AND (MAX(lineitem.l_quantity) > -450) AND (MAX(lineitem.l_quantity) > -451) AND (MAX(lineitem.l_quantity) > -452) AND (MAX(lineitem.l_quantity) > -453) AND (MAX(lineitem.l_quantity) > -454) AND (MAX(lineitem.l_quantity) > -455) AND (MAX(lineitem.l_quantity) > -456) AND (MAX(lineitem.l_quantity) > -457) AND (MAX(lineitem.l_quantity) > -458) AND (MAX(lineitem.l_quantity) > -459) AND (MAX(lineitem.l_quantity) > -460) AND (MAX(lineitem.l_quantity) > -461) AND (MAX(lineitem.l_quantity) > -462) AND (MAX(lineitem.l_quantity) > -463) AND (MAX(lineitem.l_quantity) > -464) AND (MAX(lineitem.l_quantity) > -465) AND (MAX(lineitem.l_quantity) > -466) AND (MAX(lineitem.l_quantity) > -467) AND (MAX(lineitem.l_quantity) > -468) AND (MAX(lineitem.l_quantity) > -469) AND (MAX(lineitem.l_quantity) > -470) AND (MAX(lineitem.l_quantity) > -471) AND (MAX(lineitem.l_quantity) > -472) AND (MAX(lineitem.l_quantity) > -473) AND (MAX(lineitem.l_quantity) > -474) AND (MAX(lineitem.l_quantity) > -475) AND (MAX(lineitem.l_quantity) > -476) AND (MAX(lineitem.l_quantity) > -477) AND (MAX(lineitem.l_quantity) > -478) AND (MAX(lineitem.l_quantity) > -479) AND (MAX(lineitem.l_quantity) > -480) AND (MAX(lineitem.l_quantity) > -481) AND (MAX(lineitem.l_quantity) > -482) AND (MAX(lineitem.l_quantity) > -483) AND (MAX(lineitem.l_quantity) > -484) AND (MAX(lineitem.l_quantity) > -485) AND (MAX(lineitem.l_quantity) > -486) AND (MAX(lineitem.l_quantity) > -487) AND (MAX(lineitem.l_quantity) > -488) AND (MAX(lineitem.l_quantity) > -489) AND (MAX(lineitem.l_quantity) > -490) AND (MAX(lineitem.l_quantity) > -491) AND (MAX(lineitem.l_quantity) > -492) AND (MAX(lineitem.l_quantity) > -493) AND (MAX(lineitem.l_quantity) > -494) AND (MAX(lineitem.l_quantity) > -495) AND (MAX(lineitem.l_quantity) > -496) AND (MAX(lineitem.l_quantity) > -497) AND (MAX(lineitem.l_quantity) > -498) AND (MAX(lineitem.l_quantity) > -499) AND (MAX(lineitem.l_quantity) > -500) AND (MAX(lineitem.l_quantity) > -501) AND (MAX(lineitem.l_quantity) > -502) AND (MAX(lineitem.l_quantity) > -503) AND (MAX(lineitem.l_quantity) > -504) AND (MAX(lineitem.l_quantity) > -505) AND (MAX(lineitem.l_quantity) > -506) AND (MAX(lineitem.l_quantity) > -507) AND (MAX(lineitem.l_quantity) > -508) AND (MAX(lineitem.l_quantity) > -509) AND (MAX(lineitem.l_quantity) > -510) AND (MAX(lineitem.l_quantity) > -511) AND (MAX(lineitem.l_quantity) > -512) AND (MAX(lineitem.l_quantity) > -513) AND (MAX(lineitem.l_quantity) > -514) AND (MAX(lineitem.l_quantity) > -515) AND (MAX(lineitem.l_quantity) > -516) AND (MAX(lineitem.l_quantity) > -517) AND (MAX(lineitem.l_quantity) > -518) AND (MAX(lineitem.l_quantity) > -519) AND (MAX(lineitem.l_quantity) > -520) AND (MAX(lineitem.l_quantity) > -521) AND (MAX(lineitem.l_quantity) > -522) AND (MAX(lineitem.l_quantity) > -523) AND (MAX(lineitem.l_quantity) > -524) AND (MAX(lineitem.l_quantity) > -525) AND (MAX(lineitem.l_quantity) > -526) AND (MAX(lineitem.l_quantity) > -527) AND (MAX(lineitem.l_quantity) > -528) AND (MAX(lineitem.l_quantity) > -529) AND (MAX(lineitem.l_quantity) > -530) AND (MAX(lineitem.l_quantity) > -531) AND (MAX(lineitem.l_quantity) > -532) AND (MAX(lineitem.l_quantity) > -533) AND (MAX(lineitem.l_quantity) > -534) AND (MAX(lineitem.l_quantity) > -535) AND (MAX(lineitem.l_quantity) > -536) AND (MAX(lineitem.l_quantity) > -537) AND (MAX(lineitem.l_quantity) > -538) AND (MAX(lineitem.l_quantity) > -539) AND (MAX(lineitem.l_quantity) > -540) AND (MAX(lineitem.l_quantity) > -541) AND (MAX(lineitem.l_quantity) > -542) AND (MAX(lineitem.l_quantity) > -543) AND (MAX(lineitem.l_quantity) > -544) AND (MAX(lineitem.l_quantity) > -545) AND (MAX(lineitem.l_quantity) > -546) AND (MAX(lineitem.l_quantity) > -547) AND (MAX(lineitem.l_quantity) > -548) AND (MAX(lineitem.l_quantity) > -549) AND (MAX(lineitem.l_quantity) > -550) AND (MAX(lineitem.l_quantity) > -551) AND (MAX(lineitem.l_quantity) > -552) AND (MAX(lineitem.l_quantity) > -553) AND (MAX(lineitem.l_quantity) > -554) AND (MAX(lineitem.l_quantity) > -555) AND (MAX(lineitem.l_quantity) > -556) AND (MAX(lineitem.l_quantity) > -557) AND (MAX(lineitem.l_quantity) > -558) AND (MAX(lineitem.l_quantity) > -559) AND (MAX(lineitem.l_quantity) > -560) AND (MAX(lineitem.l_quantity) > -561) AND (MAX(lineitem.l_quantity) > -562) AND (MAX(lineitem.l_quantity) > -563) AND (MAX(lineitem.l_quantity) > -564) AND (MAX(lineitem.l_quantity) > -565) AND (MAX(lineitem.l_quantity) > -566) AND (MAX(lineitem.l_quantity) > -567) AND (MAX(lineitem.l_quantity) > -568) AND (MAX(lineitem.l_quantity) > -569) AND (MAX(lineitem.l_quantity) > -570) AND (MAX(lineitem.l_quantity) > -571) AND (MAX(lineitem.l_quantity) > -572) AND (MAX(lineitem.l_quantity) > -573) AND (MAX(lineitem.l_quantity) > -574) AND (MAX(lineitem.l_quantity) > -575) AND (MAX(lineitem.l_quantity) > -576) AND (MAX(lineitem.l_quantity) > -577) AND (MAX(lineitem.l_quantity) > -578) AND (MAX(lineitem.l_quantity) > -579) AND (MAX(lineitem.l_quantity) > -580) AND (MAX(lineitem.l_quantity) > -581) AND (MAX(lineitem.l_quantity) > -582) AND (MAX(lineitem.l_quantity) > -583) AND (MAX(lineitem.l_quantity) > -584) AND (MAX(lineitem.l_quantity) > -585) AND (MAX(lineitem.l_quantity) > -586) AND (MAX(lineitem.l_quantity) > -587) AND (MAX(lineitem.l_quantity) > -588) AND (MAX(lineitem.l_quantity) > -589) AND (MAX(lineitem.l_quantity) > -590) AND (MAX(lineitem.l_quantity) > -591) AND (MAX(lineitem.l_quantity) > -592) AND (MAX(lineitem.l_quantity) > -593) AND (MAX(lineitem.l_quantity) > -594) AND (MAX(lineitem.l_quantity) > -595) AND (MAX(lineitem.l_quantity) > -596) AND (MAX(lineitem.l_quantity) > -597) AND (MAX(lineitem.l_quantity) > -598) AND (MAX(lineitem.l_quantity) > -599) AND (MAX(lineitem.l_quantity) > -600) AND (MAX(lineitem.l_quantity) > -601) AND (MAX(lineitem.l_quantity) > -602) AND (MAX(lineitem.l_quantity) > -603) AND (MAX(lineitem.l_quantity) > -604) AND (MAX(lineitem.l_quantity) > -605) AND (MAX(lineitem.l_quantity) > -606) AND (MAX(lineitem.l_quantity) > -607) AND (MAX(lineitem.l_quantity) > -608) AND (MAX(lineitem.l_quantity) > -609) AND (MAX(lineitem.l_quantity) > -610) AND (MAX(lineitem.l_quantity) > -611) AND (MAX(lineitem.l_quantity) > -612) AND (MAX(lineitem.l_quantity) > -613) AND (MAX(lineitem.l_quantity) > -614) AND (MAX(lineitem.l_quantity) > -615) AND (MAX(lineitem.l_quantity) > -616) AND (MAX(lineitem.l_quantity) > -617) AND (MAX(lineitem.l_quantity) > -618) AND (MAX(lineitem.l_quantity) > -619) AND (MAX(lineitem.l_quantity) > -620) AND (MAX(lineitem.l_quantity) > -621) AND (MAX(lineitem.l_quantity) > -622) AND (MAX(lineitem.l_quantity) > -623) AND (MAX(lineitem.l_quantity) > -624) AND (MAX(lineitem.l_quantity) > -625) AND (MAX(lineitem.l_quantity) > -626) AND (MAX(lineitem.l_quantity) > -627) AND (MAX(lineitem.l_quantity) > -628) AND (MAX(lineitem.l_quantity) > -629) AND (MAX(lineitem.l_quantity) > -630) AND (MAX(lineitem.l_quantity) > -631) AND (MAX(lineitem.l_quantity) > -632) AND (MAX(lineitem.l_quantity) > -633) AND (MAX(lineitem.l_quantity) > -634) AND (MAX(lineitem.l_quantity) > -635) AND (MAX(lineitem.l_quantity) > -636) AND (MAX(lineitem.l_quantity) > -637) AND (MAX(lineitem.l_quantity) > -638) AND (MAX(lineitem.l_quantity) > -639) AND (MAX(lineitem.l_quantity) > -640) AND (MAX(lineitem.l_quantity) > -641) AND (MAX(lineitem.l_quantity) > -642) AND (MAX(lineitem.l_quantity) > -643) AND (MAX(lineitem.l_quantity) > -644) AND (MAX(lineitem.l_quantity) > -645) AND (MAX(lineitem.l_quantity) > -646) AND (MAX(lineitem.l_quantity) > -647) AND (MAX(lineitem.l_quantity) > -648) AND (MAX(lineitem.l_quantity) > -649) AND (MAX(lineitem.l_quantity) > -650) AND (MAX(lineitem.l_quantity) > -651) AND (MAX(lineitem.l_quantity) > -652) AND (MAX(lineitem.l_quantity) > -653) AND (MAX(lineitem.l_quantity) > -654) AND (MAX(lineitem.l_quantity) > -655) AND (MAX(lineitem.l_quantity) > -656) AND (MAX(lineitem.l_quantity) > -657) AND (MAX(lineitem.l_quantity) > -658) AND (MAX(lineitem.l_quantity) > -659) AND (MAX(lineitem.l_quantity) > -660) AND (MAX(lineitem.l_quantity) > -661) AND (MAX(lineitem.l_quantity) > -662) AND (MAX(lineitem.l_quantity) > -663) AND (MAX(lineitem.l_quantity) > -664) AND (MAX(lineitem.l_quantity) > -665) AND (MAX(lineitem.l_quantity) > -666) AND (MAX(lineitem.l_quantity) > -667) AND (MAX(lineitem.l_quantity) > -668) AND (MAX(lineitem.l_quantity) > -669) AND (MAX(lineitem.l_quantity) > -670) AND (MAX(lineitem.l_quantity) > -671) AND (MAX(lineitem.l_quantity) > -672) AND (MAX(lineitem.l_quantity) > -673) AND (MAX(lineitem.l_quantity) > -674) AND (MAX(lineitem.l_quantity) > -675) AND (MAX(lineitem.l_quantity) > -676) AND (MAX(lineitem.l_quantity) > -677) AND (MAX(lineitem.l_quantity) > -678) AND (MAX(lineitem.l_quantity) > -679) AND (MAX(lineitem.l_quantity) > -680) AND (MAX(lineitem.l_quantity) > -681) AND (MAX(lineitem.l_quantity) > -682) AND (MAX(lineitem.l_quantity) > -683) AND (MAX(lineitem.l_quantity) > -684) AND (MAX(lineitem.l_quantity) > -685) AND (MAX(lineitem.l_quantity) > -686) AND (MAX(lineitem.l_quantity) > -687) AND (MAX(lineitem.l_quantity) > -688) AND (MAX(lineitem.l_quantity) > -689) AND (MAX(lineitem.l_quantity) > -690) AND (MAX(lineitem.l_quantity) > -691) AND (MAX(lineitem.l_quantity) > -692) AND (MAX(lineitem.l_quantity) > -693) AND (MAX(lineitem.l_quantity) > -694) AND (MAX(lineitem.l_quantity) > -695) AND (MAX(lineitem.l_quantity) > -696) AND (MAX(lineitem.l_quantity) > -697) AND (MAX(lineitem.l_quantity) > -698) AND (MAX(lineitem.l_quantity) > -699) AND (MAX(lineitem.l_quantity) > -700) AND (MAX(lineitem.l_quantity) > -701) AND (MAX(lineitem.l_quantity) > -702) AND (MAX(lineitem.l_quantity) > -703) AND (MAX(lineitem.l_quantity) > -704) AND (MAX(lineitem.l_quantity) > -705) AND (MAX(lineitem.l_quantity) > -706) AND (MAX(lineitem.l_quantity) > -707) AND (MAX(lineitem.l_quantity) > -708) AND (MAX(lineitem.l_quantity) > -709) AND (MAX(lineitem.l_quantity) > -710) AND (MAX(lineitem.l_quantity) > -711) AND (MAX(lineitem.l_quantity) > -712) AND (MAX(lineitem.l_quantity) > -713) AND (MAX(lineitem.l_quantity) > -714) AND (MAX(lineitem.l_quantity) > -715) AND (MAX(lineitem.l_quantity) > -716) AND (MAX(lineitem.l_quantity) > -717) AND (MAX(lineitem.l_quantity) > -718) AND (MAX(lineitem.l_quantity) > -719) AND (MAX(lineitem.l_quantity) > -720) AND (MAX(lineitem.l_quantity) > -721) AND (MAX(lineitem.l_quantity) > -722) AND (MAX(lineitem.l_quantity) > -723) AND (MAX(lineitem.l_quantity) > -724) AND (MAX(lineitem.l_quantity) > -725) AND (MAX(lineitem.l_quantity) > -726) AND (MAX(lineitem.l_quantity) > -727) AND (MAX(lineitem.l_quantity) > -728) AND (MAX(lineitem.l_quantity) > -729) AND (MAX(lineitem.l_quantity) > -730) AND (MAX(lineitem.l_quantity) > -731) AND (MAX(lineitem.l_quantity) > -732) AND (MAX(lineitem.l_quantity) > -733) AND (MAX(lineitem.l_quantity) > -734) AND (MAX(lineitem.l_quantity) > -735) AND (MAX(lineitem.l_quantity) > -736) AND (MAX(lineitem.l_quantity) > -737) AND (MAX(lineitem.l_quantity) > -738) AND (MAX(lineitem.l_quantity) > -739) AND (MAX(lineitem.l_quantity) > -740) AND (MAX(lineitem.l_quantity) > -741) AND (MAX(lineitem.l_quantity) > -742) AND (MAX(lineitem.l_quantity) > -743) AND (MAX(lineitem.l_quantity) > -744) AND (MAX(lineitem.l_quantity) > -745) AND (MAX(lineitem.l_quantity) > -746) AND (MAX(lineitem.l_quantity) > -747) AND (MAX(lineitem.l_quantity) > -748) AND (MAX(lineitem.l_quantity) > -749) AND (MAX(lineitem.l_quantity) > -750) AND (MAX(lineitem.l_quantity) > -751) AND (MAX(lineitem.l_quantity) > -752) AND (MAX(lineitem.l_quantity) > -753) AND (MAX(lineitem.l_quantity) > -754) AND (MAX(lineitem.l_quantity) > -755) AND (MAX(lineitem.l_quantity) > -756) AND (MAX(lineitem.l_quantity) > -757) AND (MAX(lineitem.l_quantity) > -758) AND (MAX(lineitem.l_quantity) > -759) AND (MAX(lineitem.l_quantity) > -760) AND (MAX(lineitem.l_quantity) > -761) AND (MAX(lineitem.l_quantity) > -762) AND (MAX(lineitem.l_quantity) > -763) AND (MAX(lineitem.l_quantity) > -764) AND (MAX(lineitem.l_quantity) > -765) AND (MAX(lineitem.l_quantity) > -766) AND (MAX(lineitem.l_quantity) > -767) AND (MAX(lineitem.l_quantity) > -768) AND (MAX(lineitem.l_quantity) > -769) AND (MAX(lineitem.l_quantity) > -770) AND (MAX(lineitem.l_quantity) > -771) AND (MAX(lineitem.l_quantity) > -772) AND (MAX(lineitem.l_quantity) > -773) AND (MAX(lineitem.l_quantity) > -774) AND (MAX(lineitem.l_quantity) > -775) AND (MAX(lineitem.l_quantity) > -776) AND (MAX(lineitem.l_quantity) > -777) AND (MAX(lineitem.l_quantity) > -778) AND (MAX(lineitem.l_quantity) > -779) AND (MAX(lineitem.l_quantity) > -780) AND (MAX(lineitem.l_quantity) > -781) AND (MAX(lineitem.l_quantity) > -782) AND (MAX(lineitem.l_quantity) > -783) AND (MAX(lineitem.l_quantity) > -784) AND (MAX(lineitem.l_quantity) > -785) AND (MAX(lineitem.l_quantity) > -786) AND (MAX(lineitem.l_quantity) > -787) AND (MAX(lineitem.l_quantity) > -788) AND (MAX(lineitem.l_quantity) > -789) AND (MAX(lineitem.l_quantity) > -790) AND (MAX(lineitem.l_quantity) > -791) AND (MAX(lineitem.l_quantity) > -792) AND (MAX(lineitem.l_quantity) > -793) AND (MAX(lineitem.l_quantity) > -794) AND (MAX(lineitem.l_quantity) > -795) AND (MAX(lineitem.l_quantity) > -796) AND (MAX(lineitem.l_quantity) > -797) AND (MAX(lineitem.l_quantity) > -798) AND (MAX(lineitem.l_quantity) > -799) AND (MAX(lineitem.l_quantity) > -800) AND (MAX(lineitem.l_quantity) > -801) AND (MAX(lineitem.l_quantity) > -802) AND (MAX(lineitem.l_quantity) > -803) AND (MAX(lineitem.l_quantity) > -804) AND (MAX(lineitem.l_quantity) > -805) AND (MAX(lineitem.l_quantity) > -806) AND (MAX(lineitem.l_quantity) > -807) AND (MAX(lineitem.l_quantity) > -808) AND (MAX(lineitem.l_quantity) > -809) AND (MAX(lineitem.l_quantity) > -810) AND (MAX(lineitem.l_quantity) > -811) AND (MAX(lineitem.l_quantity) > -812) AND (MAX(lineitem.l_quantity) > -813) AND (MAX(lineitem.l_quantity) > -814) AND (MAX(lineitem.l_quantity) > -815) AND (MAX(lineitem.l_quantity) > -816) AND (MAX(lineitem.l_quantity) > -817) AND (MAX(lineitem.l_quantity) > -818) AND (MAX(lineitem.l_quantity) > -819) AND (MAX(lineitem.l_quantity) > -820) AND (MAX(lineitem.l_quantity) > -821) AND (MAX(lineitem.l_quantity) > -822) AND (MAX(lineitem.l_quantity) > -823) AND (MAX(lineitem.l_quantity) > -824) AND (MAX(lineitem.l_quantity) > -825) AND (MAX(lineitem.l_quantity) > -826) AND (MAX(lineitem.l_quantity) > -827) AND (MAX(lineitem.l_quantity) > -828) AND (MAX(lineitem.l_quantity) > -829) AND (MAX(lineitem.l_quantity) > -830) AND (MAX(lineitem.l_quantity) > -831) AND (MAX(lineitem.l_quantity) > -832) AND (MAX(lineitem.l_quantity) > -833) AND (MAX(lineitem.l_quantity) > -834) AND (MAX(lineitem.l_quantity) > -835) AND (MAX(lineitem.l_quantity) > -836) AND (MAX(lineitem.l_quantity) > -837) AND (MAX(lineitem.l_quantity) > -838) AND (MAX(lineitem.l_quantity) > -839) AND (MAX(lineitem.l_quantity) > -840) AND (MAX(lineitem.l_quantity) > -841) AND (MAX(lineitem.l_quantity) > -842) AND (MAX(lineitem.l_quantity) > -843) AND (MAX(lineitem.l_quantity) > -844) AND (MAX(lineitem.l_quantity) > -845) AND (MAX(lineitem.l_quantity) > -846) AND (MAX(lineitem.l_quantity) > -847) AND (MAX(lineitem.l_quantity) > -848) AND (MAX(lineitem.l_quantity) > -849) AND (MAX(lineitem.l_quantity) > -850) AND (MAX(lineitem.l_quantity) > -851) AND (MAX(lineitem.l_quantity) > -852) AND (MAX(lineitem.l_quantity) > -853) AND (MAX(lineitem.l_quantity) > -854) AND (MAX(lineitem.l_quantity) > -855) AND (MAX(lineitem.l_quantity) > -856) AND (MAX(lineitem.l_quantity) > -857) AND (MAX(lineitem.l_quantity) > -858) AND (MAX(lineitem.l_quantity) > -859) AND (MAX(lineitem.l_quantity) > -860) AND (MAX(lineitem.l_quantity) > -861) AND (MAX(lineitem.l_quantity) > -862) AND (MAX(lineitem.l_quantity) > -863) AND (MAX(lineitem.l_quantity) > -864) AND (MAX(lineitem.l_quantity) > -865) AND (MAX(lineitem.l_quantity) > -866) AND (MAX(lineitem.l_quantity) > -867) AND (MAX(lineitem.l_quantity) > -868) AND (MAX(lineitem.l_quantity) > -869) AND (MAX(lineitem.l_quantity) > -870) AND (MAX(lineitem.l_quantity) > -871) AND (MAX(lineitem.l_quantity) > -872) AND (MAX(lineitem.l_quantity) > -873) AND (MAX(lineitem.l_quantity) > -874) AND (MAX(lineitem.l_quantity) > -875) AND (MAX(lineitem.l_quantity) > -876) AND (MAX(lineitem.l_quantity) > -877) AND (MAX(lineitem.l_quantity) > -878) AND (MAX(lineitem.l_quantity) > -879) AND (MAX(lineitem.l_quantity) > -880) AND (MAX(lineitem.l_quantity) > -881) AND (MAX(lineitem.l_quantity) > -882) AND (MAX(lineitem.l_quantity) > -883) AND (MAX(lineitem.l_quantity) > -884) AND (MAX(lineitem.l_quantity) > -885) AND (MAX(lineitem.l_quantity) > -886) AND (MAX(lineitem.l_quantity) > -887) AND (MAX(lineitem.l_quantity) > -888) AND (MAX(lineitem.l_quantity) > -889) AND (MAX(lineitem.l_quantity) > -890) AND (MAX(lineitem.l_quantity) > -891) AND (MAX(lineitem.l_quantity) > -892) AND (MAX(lineitem.l_quantity) > -893) AND (MAX(lineitem.l_quantity) > -894) AND (MAX(lineitem.l_quantity) > -895) AND (MAX(lineitem.l_quantity) > -896) AND (MAX(lineitem.l_quantity) > -897) AND (MAX(lineitem.l_quantity) > -898) AND (MAX(lineitem.l_quantity) > -899) AND (MAX(lineitem.l_quantity) > -900) AND (MAX(lineitem.l_quantity) > -901) AND (MAX(lineitem.l_quantity) > -902) AND (MAX(lineitem.l_quantity) > -903) AND (MAX(lineitem.l_quantity) > -904) AND (MAX(lineitem.l_quantity) > -905) AND (MAX(lineitem.l_quantity) > -906) AND (MAX(lineitem.l_quantity) > -907) AND (MAX(lineitem.l_quantity) > -908) AND (MAX(lineitem.l_quantity) > -909) AND (MAX(lineitem.l_quantity) > -910) AND (MAX(lineitem.l_quantity) > -911) AND (MAX(lineitem.l_quantity) > -912) AND (MAX(lineitem.l_quantity) > -913) AND (MAX(lineitem.l_quantity) > -914) AND (MAX(lineitem.l_quantity) > -915) AND (MAX(lineitem.l_quantity) > -916) AND (MAX(lineitem.l_quantity) > -917) AND (MAX(lineitem.l_quantity) > -918) AND (MAX(lineitem.l_quantity) > -919) AND (MAX(lineitem.l_quantity) > -920) AND (MAX(lineitem.l_quantity) > -921) AND (MAX(lineitem.l_quantity) > -922) AND (MAX(lineitem.l_quantity) > -923) AND (MAX(lineitem.l_quantity) > -924) AND (MAX(lineitem.l_quantity) > -925) AND (MAX(lineitem.l_quantity) > -926) AND (MAX(lineitem.l_quantity) > -927) AND (MAX(lineitem.l_quantity) > -928) AND (MAX(lineitem.l_quantity) > -929) AND (MAX(lineitem.l_quantity) > -930) AND (MAX(lineitem.l_quantity) > -931) AND (MAX(lineitem.l_quantity) > -932) AND (MAX(lineitem.l_quantity) > -933) AND (MAX(lineitem.l_quantity) > -934) AND (MAX(lineitem.l_quantity) > -935) AND (MAX(lineitem.l_quantity) > -936) AND (MAX(lineitem.l_quantity) > -937) AND (MAX(lineitem.l_quantity) > -938) AND (MAX(lineitem.l_quantity) > -939) AND (MAX(lineitem.l_quantity) > -940) AND (MAX(lineitem.l_quantity) > -941) AND (MAX(lineitem.l_quantity) > -942) AND (MAX(lineitem.l_quantity) > -943) AND (MAX(lineitem.l_quantity) > -944) AND (MAX(lineitem.l_quantity) > -945) AND (MAX(lineitem.l_quantity) > -946) AND (MAX(lineitem.l_quantity) > -947) AND (MAX(lineitem.l_quantity) > -948) AND (MAX(lineitem.l_quantity) > -949) AND (MAX(lineitem.l_quantity) > -950) AND (MAX(lineitem.l_quantity) > -951) AND (MAX(lineitem.l_quantity) > -952) AND (MAX(lineitem.l_quantity) > -953) AND (MAX(lineitem.l_quantity) > -954) AND (MAX(lineitem.l_quantity) > -955) AND (MAX(lineitem.l_quantity) > -956) AND (MAX(lineitem.l_quantity) > -957) AND (MAX(lineitem.l_quantity) > -958) AND (MAX(lineitem.l_quantity) > -959) AND (MAX(lineitem.l_quantity) > -960) AND (MAX(lineitem.l_quantity) > -961) AND (MAX(lineitem.l_quantity) > -962) AND (MAX(lineitem.l_quantity) > -963) AND (MAX(lineitem.l_quantity) > -964) AND (MAX(lineitem.l_quantity) > -965) AND (MAX(lineitem.l_quantity) > -966) AND (MAX(lineitem.l_quantity) > -967) AND (MAX(lineitem.l_quantity) > -968) AND (MAX(lineitem.l_quantity) > -969) AND (MAX(lineitem.l_quantity) > -970) AND (MAX(lineitem.l_quantity) > -971) AND (MAX(lineitem.l_quantity) > -972) AND (MAX(lineitem.l_quantity) > -973) AND (MAX(lineitem.l_quantity) > -974) AND (MAX(lineitem.l_quantity) > -975) AND (MAX(lineitem.l_quantity) > -976) AND (MAX(lineitem.l_quantity) > -977) AND (MAX(lineitem.l_quantity) > -978) AND (MAX(lineitem.l_quantity) > -979) AND (MAX(lineitem.l_quantity) > -980) AND (MAX(lineitem.l_quantity) > -981) AND (MAX(lineitem.l_quantity) > -982) AND (MAX(lineitem.l_quantity) > -983) AND (MAX(lineitem.l_quantity) > -984) AND (MAX(lineitem.l_quantity) > -985) AND (MAX(lineitem.l_quantity) > -986) AND (MAX(lineitem.l_quantity) > -987) AND (MAX(lineitem.l_quantity) > -988) AND (MAX(lineitem.l_quantity) > -989) AND (MAX(lineitem.l_quantity) > -990) AND (MAX(lineitem.l_quantity) > -991) AND (MAX(lineitem.l_quantity) > -992) AND (MAX(lineitem.l_quantity) > -993) AND (MAX(lineitem.l_quantity) > -994) AND (MAX(lineitem.l_quantity) > -995) AND (MAX(lineitem.l_quantity) > -996) AND (MAX(lineitem.l_quantity) > -997) AND (MAX(lineitem.l_quantity) > -998) AND (MAX(lineitem.l_quantity) > -999)
)
SELECT
    generated_table."l_returnflag", generated_table."l_linestatus", generated_table."sum_qty", generated_table."sum_base_price", generated_table."sum_disc_price", generated_table."sum_charge", generated_table."avg_qty", generated_table."avg_price", generated_table."avg_disc", generated_table."count_order"
FROM {temp_table_name} AS generated_table
JOIN lineage
    ON generated_table.rowid::bigint = lineage.out_index::bigint
ORDER BY generated_table.l_returnflag, generated_table.l_linestatus""",
}


EXPECTED_DFC_1PHASE_OPTIMIZED_SQL_Q01 = {
    1: r"""SELECT
  l_returnflag,
  l_linestatus,
  SUM(l_quantity) AS sum_qty,
  SUM(l_extendedprice) AS sum_base_price,
  SUM(l_extendedprice * (
    1 - l_discount
  )) AS sum_disc_price,
  SUM(l_extendedprice * (
    1 - l_discount
  ) * (
    1 + l_tax
  )) AS sum_charge,
  AVG(l_quantity) AS avg_qty,
  AVG(l_extendedprice) AS avg_price,
  AVG(l_discount) AS avg_disc,
  COUNT(*) AS count_order
FROM lineitem
WHERE
  l_shipdate <= CAST('1998-09-02' AS DATE)
GROUP BY
  l_returnflag,
  l_linestatus
HAVING
  (
    MAX(lineitem.l_quantity) > 0
  )
ORDER BY
  l_returnflag,
  l_linestatus""",
    10: r"""SELECT
  l_returnflag,
  l_linestatus,
  SUM(l_quantity) AS sum_qty,
  SUM(l_extendedprice) AS sum_base_price,
  SUM(l_extendedprice * (
    1 - l_discount
  )) AS sum_disc_price,
  SUM(l_extendedprice * (
    1 - l_discount
  ) * (
    1 + l_tax
  )) AS sum_charge,
  AVG(l_quantity) AS avg_qty,
  AVG(l_extendedprice) AS avg_price,
  AVG(l_discount) AS avg_disc,
  COUNT(*) AS count_order
FROM lineitem
WHERE
  l_shipdate <= CAST('1998-09-02' AS DATE)
GROUP BY
  l_returnflag,
  l_linestatus
HAVING
  (
    MAX(lineitem.l_quantity) > 0
  )
ORDER BY
  l_returnflag,
  l_linestatus""",
    100: r"""SELECT
  l_returnflag,
  l_linestatus,
  SUM(l_quantity) AS sum_qty,
  SUM(l_extendedprice) AS sum_base_price,
  SUM(l_extendedprice * (
    1 - l_discount
  )) AS sum_disc_price,
  SUM(l_extendedprice * (
    1 - l_discount
  ) * (
    1 + l_tax
  )) AS sum_charge,
  AVG(l_quantity) AS avg_qty,
  AVG(l_extendedprice) AS avg_price,
  AVG(l_discount) AS avg_disc,
  COUNT(*) AS count_order
FROM lineitem
WHERE
  l_shipdate <= CAST('1998-09-02' AS DATE)
GROUP BY
  l_returnflag,
  l_linestatus
HAVING
  (
    MAX(lineitem.l_quantity) > 0
  )
ORDER BY
  l_returnflag,
  l_linestatus""",
    1000: r"""SELECT
  l_returnflag,
  l_linestatus,
  SUM(l_quantity) AS sum_qty,
  SUM(l_extendedprice) AS sum_base_price,
  SUM(l_extendedprice * (
    1 - l_discount
  )) AS sum_disc_price,
  SUM(l_extendedprice * (
    1 - l_discount
  ) * (
    1 + l_tax
  )) AS sum_charge,
  AVG(l_quantity) AS avg_qty,
  AVG(l_extendedprice) AS avg_price,
  AVG(l_discount) AS avg_disc,
  COUNT(*) AS count_order
FROM lineitem
WHERE
  l_shipdate <= CAST('1998-09-02' AS DATE)
GROUP BY
  l_returnflag,
  l_linestatus
HAVING
  (
    MAX(lineitem.l_quantity) > 0
  )
ORDER BY
  l_returnflag,
  l_linestatus""",
}


@pytest.mark.parametrize("policy_count", POLICY_COUNTS)
def test_tpch_q01_optimized_logical_policy_counts_rewrite(tpch_conn, policy_count):
    """Ensure optimized logical rewrite SQL matches expected for Q01."""
    _ = tpch_conn
    query = load_tpch_query(1)

    policies = build_tpch_q01_optimized_policies(policy_count)
    rewritten = rewrite_query_logical_multi(query, policies)
    expected = EXPECTED_SQL_Q01[policy_count]
    base_query, filter_query_template, _ = rewrite_query_physical(
        query,
        policies,
        lineage_query='SELECT "output_id" AS out_index, "opid_8_lineitem" AS "lineitem" FROM read_block(0)',
    )

    assert rewritten == expected, (
        "Logical SQL does not match expected.\n"
        f"Policy count: {policy_count}\n"
        f"Expected SQL:\n{expected}\n\n"
        f"Actual SQL:\n{rewritten}"
    )
    assert base_query == query, (
        "Physical base SQL does not match expected for Q01.\n"
        f"Policy count: {policy_count}\n"
        f"Expected SQL:\n{query}\n\n"
        f"Actual SQL:\n{base_query}"
    )
    _assert_sql_equal(
        PHYSICAL_EXPECTED_SQL_Q01[policy_count],
        filter_query_template,
        f"Physical filter SQL does not match expected for Q01 (count={policy_count}).\n",
    )


@pytest.mark.parametrize("policy_count", POLICY_COUNTS)
def test_tpch_q01_optimized_dfc_2phase_matches_1phase(policy_count):
    """Ensure two-phase DFC returns identical results to one-phase DFC for optimized Q01."""
    conn = _ensure_smokedduck().connect(":memory:")
    with contextlib.suppress(Exception):
        conn.execute("INSTALL tpch")
    conn.execute("LOAD tpch")
    conn.execute("CALL dbgen(sf=0.1)")

    try:
        query = load_tpch_query(1)
        policies = build_tpch_q01_optimized_policies(policy_count)
        rewriter = SQLRewriter(conn=conn)
        for policy in policies:
            rewriter.register_policy(policy)

        dfc_1phase_results = rewriter.execute(query).fetchall()
        dfc_2phase_results = rewriter.execute(query, use_two_phase=True).fetchall()
    finally:
        conn.close()

    match, error = compare_results_exact(dfc_1phase_results, dfc_2phase_results)
    assert match, (
        "Two-phase DFC results do not match one-phase DFC.\n"
        f"Policy count: {policy_count}\n"
        f"Details: {error}"
    )


@pytest.mark.parametrize("policy_count", POLICY_COUNTS)
def test_tpch_q01_optimized_dfc_1phase_optimized_rewrite_and_results(policy_count):
    """Ensure strongest single-policy rewrite is exact and matches one-phase DFC results."""
    full_conn = _ensure_smokedduck().connect(":memory:")
    optimized_conn = _ensure_smokedduck().connect(":memory:")
    for conn in [full_conn, optimized_conn]:
        with contextlib.suppress(Exception):
            conn.execute("INSTALL tpch")
        conn.execute("LOAD tpch")
        conn.execute("CALL dbgen(sf=0.1)")

    try:
        query = load_tpch_query(1)

        full_rewriter = SQLRewriter(conn=full_conn)
        for policy in build_tpch_q01_optimized_policies(policy_count):
            full_rewriter.register_policy(policy)
        dfc_1phase_results = full_rewriter.execute(query).fetchall()

        optimized_rewriter = SQLRewriter(conn=optimized_conn)
        optimized_rewriter.register_policy(build_tpch_q01_optimized_strongest_policy(policy_count))
        optimized_rewritten = optimized_rewriter.transform_query(query)
        dfc_1phase_optimized_results = optimized_conn.execute(optimized_rewritten).fetchall()
    finally:
        full_conn.close()
        optimized_conn.close()

    expected_sql = EXPECTED_DFC_1PHASE_OPTIMIZED_SQL_Q01[policy_count]
    assert optimized_rewritten == expected_sql, (
        "Optimized one-phase DFC SQL does not match expected.\n"
        f"Policy count: {policy_count}\n"
        f"Expected SQL:\n{expected_sql}\n\n"
        f"Actual SQL:\n{optimized_rewritten}"
    )

    match, error = compare_results_exact(dfc_1phase_results, dfc_1phase_optimized_results)
    assert match, (
        "Optimized one-phase DFC results do not match standard one-phase DFC.\n"
        f"Policy count: {policy_count}\n"
        f"Details: {error}"
    )


@pytest.mark.parametrize("policy_count", [1, 10, 100])
def test_cached_optimized_queries_match_live_rewrite_results(policy_count):
    """Ensure cached optimized queries return the same results as live rewrites."""
    conn = _ensure_smokedduck().connect(":memory:")
    with contextlib.suppress(Exception):
        conn.execute("INSTALL tpch")
    conn.execute("LOAD tpch")
    conn.execute("CALL dbgen(sf=0.1)")

    try:
        query = load_tpch_query(1)
        policies = build_tpch_q01_optimized_policies(policy_count)
        strongest_policy = build_tpch_q01_optimized_strongest_policy(policy_count)
        cached_queries = get_cached_tpch_q01_optimized_queries(policy_count)

        rewriter = SQLRewriter(conn=conn)
        for policy in policies:
            rewriter.register_policy(policy)

        live_dfc_1phase = conn.execute(rewriter.transform_query(query)).fetchall()
        cached_dfc_1phase = conn.execute(cached_queries["dfc_1phase"]).fetchall()
        match, error = compare_results_exact(live_dfc_1phase, cached_dfc_1phase)
        assert match, error

        live_dfc_2phase = conn.execute(rewriter.transform_query(query, use_two_phase=True)).fetchall()
        cached_dfc_2phase = conn.execute(cached_queries["dfc_2phase"]).fetchall()
        match, error = compare_results_exact(live_dfc_2phase, cached_dfc_2phase)
        assert match, error

        live_logical = conn.execute(rewrite_query_logical_multi(query, policies)).fetchall()
        cached_logical = conn.execute(cached_queries["logical"]).fetchall()
        match, error = compare_results_exact(live_logical, cached_logical)
        assert match, error

        for policy in list(rewriter.get_dfc_policies()):
            rewriter.delete_policy(
                sources=policy.sources,
                constraint=policy.constraint,
                on_fail=policy.on_fail,
            )
        rewriter.register_policy(strongest_policy)

        live_dfc_1phase_optimized = conn.execute(rewriter.transform_query(query)).fetchall()
        cached_dfc_1phase_optimized = conn.execute(cached_queries["dfc_1phase_optimized"]).fetchall()
        match, error = compare_results_exact(live_dfc_1phase_optimized, cached_dfc_1phase_optimized)
        assert match, error

        live_physical, _, live_physical_error, _, _ = execute_query_physical_detailed(
            conn,
            query,
            policies,
        )
        assert live_physical_error is None

        cached_physical, _, cached_physical_error, _, _ = execute_precomputed_query_physical_detailed(
            conn,
            cached_queries["physical_base"],
            cached_queries["physical_filter_template"],
            "lineitem",
        )
        assert cached_physical_error is None

        match, error = compare_results_exact(live_physical, cached_physical)
        assert match, error
    finally:
        conn.close()
